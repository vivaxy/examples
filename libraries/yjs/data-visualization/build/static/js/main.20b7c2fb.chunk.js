(this["webpackJsonpdata-visualization"]=this["webpackJsonpdata-visualization"]||[]).push([[0],{35:function(t,e,n){},37:function(t,e,n){},39:function(t,e,n){},40:function(t,e,n){},41:function(t,e,n){},42:function(t,e,n){},43:function(t,e,n){},50:function(t,e,n){},51:function(t,e,n){},52:function(t,e,n){"use strict";n.r(e);var c=n(18),r=n.n(c),o=n(29),a=n.n(o),s=(n(35),n(19)),i=n(17),u=n.n(i),l=n(13),p=n(22),d=n(12),f=n(15),h="CUSTOM_SCENARIO",j=(n(37),n(4));function b(t){return Object(j.jsxs)("div",{className:"actions",children:[Object(j.jsx)("span",{children:"Actions: "}),Object(j.jsx)("button",{onClick:t.onOpenDoc,children:"Open a new doc"})]})}var O="DOC_OPEN",x="DOC_UPDATE",y="DOC_SYNC",v="DOC_CLOSE",m="INSERT",g="DELETE";n(39);function k(t){var e=Object(d.a)(t,2),n=e[0],c=e[1];switch(n){case O:return n;case x:var r=c.id;return c.actions.map((function(t){if(t.type===m)return"".concat(n," Doc:").concat(r," type:").concat(t.type," pos:").concat(t.pos," str:").concat(t.str);if(t.type===g)return"".concat(n," Doc:").concat(r," type:").concat(t.type," pos:").concat(t.pos," len:").concat(t.len);throw new Error("Unexpect edit type: "+t.type)})).join(" ; ");case y:return void 0===c.index?"".concat(n," FromDoc:").concat(c.from," ToDoc:").concat(c.to):"".concat(n," FromDoc:").concat(c.from," ToDoc:").concat(c.to," updateIndex:").concat(c.index);case v:return n;default:throw new Error("Expected action: "+n)}}function D(t){var e="scenarios";var n=t.scenarios[t.currentScenario],c=n&&n[t.currentScenarioStepIndex-1],r=n&&n[t.currentScenarioStepIndex];return Object(j.jsxs)("div",{className:"scenarios",children:[Object(j.jsx)("label",{htmlFor:e,children:"Scenarios: "}),Object(j.jsxs)("select",{id:e,onChange:function(e){e.target.value!==t.currentScenario&&t.onScenarioChange(e.target.value)},children:[Object(j.jsx)("option",{value:h,children:"Custom"}),Object.keys(t.scenarios).map((function(t){return Object(j.jsx)("option",{value:t,children:t},t)}))]}),n&&Object(j.jsx)("button",{disabled:t.currentScenario===h,onClick:function(){var e=t.scenarios[t.currentScenario];t.currentScenarioStepIndex<e.length?t.onNextStep():t.onRestartStep()},className:"next-step-button",children:r?"Next step":"Restart"}),r&&Object(j.jsx)("span",{className:"next-step",children:k(r)}),c&&Object(j.jsxs)("p",{className:"current-step",children:[Object(j.jsx)("span",{className:"current-step-label",children:"Current step: "}),Object(j.jsx)("span",{children:k(c)})]}),!n&&Object(j.jsx)(b,{onOpenDoc:function(){t.onOpenDoc()}})]})}n(40);function S(t){return Object(j.jsxs)("div",{className:"doc-tab",children:[Object(j.jsxs)("p",{className:"doc-id",children:["Doc",t.doc.id]}),t.editable&&Object(j.jsx)("button",{className:"doc-close",onClick:function(){t.onCloseDoc(t.doc)},children:"x"})]})}var w="sample-key";n(41);function N(t,e,n){var c=function(t,e,n){for(var c=Math.min(Math.max(t.length-1,0),Math.max(e.length-1,0),n),r=0;r<=c;r++)if(t[r]!==e[r])return r;return 0===t.length||0===e.length?0:c+1}(t,e,n),r=function(t,e,n){for(var c=Math.min(Math.max(t.length-1,0),Math.max(e.length-n,0)),r=0;r<=c;r++)if(t[t.length-1-r]!==e[e.length-1-r])return r;return c}(t,e,n);if(c+r>t.length-1||c+r>e.length-1){var o=function(t,e,n){if(t.length>e.length)return{type:g,pos:n,len:t.length-e.length};if(t.length<e.length){var c=n-(e.length-t.length);return{type:m,pos:c,str:e.slice(c,n)}}return null}(t,e,n);return o?[o]:[]}var a={pos:c,len:t.length-r-c},s={pos:c,str:e.slice(c,e.length-r)},i=[];return a.len&&i.push({type:g,pos:a.pos,len:a.len}),s.str.length&&i.push({type:m,pos:s.pos,str:s.str}),i}function C(t){return t.getText(w).toString()}function E(t){var e=Object(c.useRef)(null),n=Object(c.useRef)(C(t.doc.yDoc));return Object(c.useEffect)((function(){var c=C(t.doc.yDoc);e.current.textContent!==c&&(e.current.textContent=c),n.current!==c&&(n.current=c)})),Object(j.jsx)("p",{contentEditable:t.editable?"true":"false",className:"editor",onInput:function(e){var c=e.target.textContent;if(n.current!==c){var r=window.getSelection().getRangeAt(0).startOffset,o=N(n.current,c,r);o.length&&(n.current=c,t.onEditorChange({id:t.doc.id,actions:o}))}},ref:e})}n(42);function T(t){return"".concat(t.type," ").concat(t.pos," ").concat(t.str||t.len)}function I(t){function e(e,n){return function(){t.onSync({from:t.doc.id,to:e,index:n})}}return Object(j.jsx)("div",{className:"updates",children:t.doc.updates.map((function(n,c){return Object(j.jsxs)("p",{className:"update",children:[Object(j.jsx)("span",{className:"update-detail".concat(n.action.type===m?" insert":" delete"),children:T(n.action)}),t.editable&&t.docs.filter((function(e){return e&&e.id!==t.doc.id})).map((function(t){return Object(j.jsxs)("button",{className:"sync-button",onClick:e(t.id,c),children:["To Doc",t.id]},t.id)}))]},c+T(n.action))}))})}n(43);function _(t){var e=[];return t.forEach((function(t,n){e.push(Object(j.jsxs)("p",{children:[Object(j.jsxs)("span",{className:"client-id",children:[n,":"]}),Object(j.jsx)("span",{children:t})]},n))})),e}function M(t,e){return t?[Object(j.jsxs)("div",{className:"item".concat(t.content.str?" insert":" delete").concat(t.id.client===e?" current":" link"),children:[Object(j.jsx)("p",{className:"clock",children:t.id.clock}),Object(j.jsx)("p",{className:"item-value",children:t.content.str||t.content.len})]},"".concat((n=t).id.client," ").concat(n.id.clock))].concat(Object(l.a)(M(t.right,e))):[];var n}function R(t,e){var n=[],c=new f.d(t);return c.dss.forEach((function(t,r){c.clients.get(e)===r&&t.clients.forEach((function(t,e){t.forEach((function(t){n.push(Object(j.jsxs)("div",{className:"item delete",children:[Object(j.jsx)("p",{className:"clock",children:t.clock}),Object(j.jsx)("p",{className:"item-value",children:t.len})]},"".concat(e,"-").concat(t.clock)))}))}))})),n}function U(t){var e=[];return t.yDoc.store.clients.forEach((function(n,c){e.push(Object(j.jsxs)("div",{className:"client",children:[Object(j.jsxs)("p",{className:"client-id",children:["clientID: ",c]}),Object(j.jsx)("p",{className:"label",children:"Text:"}),Object(j.jsx)("div",{className:"client-text",children:M(t.yDoc.getText(w)._start,c)}),Object(j.jsx)("p",{className:"label",children:"DeleteSet:"}),Object(j.jsx)("div",{className:"pud",children:R(t.yDoc,c)})]},c))})),Object(j.jsxs)("div",{className:"y-doc-model",children:[t.yDoc.store.pendingStructs&&Object(j.jsxs)("div",{className:"pending-structs",children:[Object(j.jsx)("p",{children:"missing:"}),_(t.yDoc.store.pendingStructs.missing)]}),Object(j.jsx)("div",{className:"clients",children:e})]})}n(50);function F(t){return Object(j.jsxs)("div",{className:"doc-container",children:[Object(j.jsx)(S,{doc:t.doc,onCloseDoc:t.onCloseDoc,editable:t.editable}),Object(j.jsx)(E,{doc:t.doc,onEditorChange:t.onEditorChange,editable:t.editable}),Object(j.jsx)(I,{doc:t.doc,docs:t.docs,onSync:t.onSync,editable:t.editable}),Object(j.jsx)(U,{yDoc:t.doc.yDoc})]})}var L={DocEdit:[[O],[x,{id:0,actions:[{type:m,pos:0,str:"FOO"}]}],[x,{id:0,actions:[{type:g,pos:1,len:1}]}],[x,{id:0,actions:[{type:m,pos:1,str:"T"}]}],[x,{id:0,actions:[{type:m,pos:1,str:"B"}]}]],TwoDocsSyncWithoutConflicts:[[O],[O],[x,{id:0,actions:[{type:m,pos:0,str:"FOO"}]}],[y,{from:0,to:1}],[x,{id:1,actions:[{type:g,pos:1,len:1}]}],[x,{id:1,actions:[{type:m,pos:1,str:"T"}]}],[y,{from:1,to:0}]],TwoDocsSyncWithConflicts:[[O],[O],[x,{id:0,actions:[{type:m,pos:0,str:"FOO"}]}],[y,{from:0,to:1}],[x,{id:0,actions:[{type:m,pos:3,str:"B"}]}],[x,{id:1,actions:[{type:m,pos:3,str:"T"}]}],[y,{from:1,to:0}],[y,{from:0,to:1}]],TwoDocsSyncWithLostUpdates:[[O],[O],[x,{id:0,actions:[{type:m,pos:0,str:"FOO"}]}],[y,{from:0,to:1}],[x,{id:0,actions:[{type:m,pos:3,str:"B"}]}],[x,{id:0,actions:[{type:m,pos:4,str:"AR"}]}],[x,{id:1,actions:[{type:m,pos:3,str:"T"}]}],[y,{from:0,to:1,index:1}],[y,{from:1,to:0}],[y,{from:0,to:1,index:0}]]};function A(t){return new Promise((function(e){setTimeout(e,t)}))}var B=n(2),V=n(0),P=n(3),J=n(11),W=[function(){return new f.a},function(){return new f.c},function(){return new f.e},function(t){V.j(t)},function(t){},function(t){V.j(t)},function(t){}];var z=[function(){throw J.c()},function(t){return{type:"deleted",length:V.k(t)}},function(t){for(var e=V.k(t),n=[],c=0;c<e;c++){var r=V.j(t);"undefined"===r?n.push(void 0):n.push(JSON.parse(r))}return{type:"json",content:n,length:e}},function(t){return{type:"binary",content:V.l(t),length:1}},function(t){var e=V.j(t);return{type:"string",string:e,length:e.length}},function(t){return{type:"embed",content:V.j(t),length:1}},function(t){return{type:"format",content:{key:V.j(t),value:V.j(t)},length:1}},function(t){return{type:"type",content:W[V.k(t)](t),length:1}},function(t){for(var e=V.k(t),n=[],c=0;c<e;c++){var r=V.g(t);n.push(r)}return{type:"any",content:n,length:e}}];function Y(t,e){var n=function(t){for(var e=new Map,n=V.k(t),c=0,r=0;r<n;r++){for(var o=V.k(t),a=[],s=K(t),i=s.clock,u=s.client,l=0;l<o;l++){var p=V.h(t),d=void 0;d=0!==(P.i&p)?G(u,i,t,p):new q(u,i,{length:V.k(t)}),a.push(d),i+=d.length,c+=d.length}e.set(u,{items:a,totalLength:c})}return e}(V.e(e)).get(t);return null==n?{clientID:t}:{clock:n.items[0].clock,clientID:t,totalLength:n.totalLength,items:n.items}}function K(t){return{client:V.k(t),clock:V.k(t)}}var q=function t(e,n,c,r,o,a,s,i,u){var l=this;Object(B.a)(this,t),this.client=e,this.clock=n,this.left=r,this.origin=o,this.right=a,this.rightOrigin=s,this.parentYKey=i,this.parent=u,Object.keys(c).forEach((function(t){l[t]=c[t]}))};function G(t,e,n,c){var r=(c&P.g)===P.g?K(n):null,o=(c&P.f)===P.f?K(n):null,a=0===(c&(P.f|P.g)),s=!!a&&1===V.k(n),i=a&&s?V.j(n):null,u=null;a&&!s&&(u=K(n)),a&&(c&P.e)===P.e&&V.j(n);var l=function(t,e){return z[e&P.i](t)}(n,c);return new q(t,e,l,null,r,null,o,i,u)}function H(t){for(var e={clients:{}},n=V.e(t),c=V.k(n),r=0;r<c;r++){var o=V.k(n),a=V.k(n);if(a>0){e.clients[o]=[];for(var s=0;s<a;s++)e.clients[o].push({clock:V.k(n),length:V.k(n)})}}return e}n(51);function Q(){var t,e=Object(c.useState)((t="scenario",new URL(window.location.href).searchParams.get(t)||h)),n=Object(d.a)(e,2),r=n[0],o=n[1],a=Object(c.useState)(0),i=Object(d.a)(a,2),b=i[0],k=i[1],S=Object(c.useState)([]),N=Object(d.a)(S,2),C=N[0],E=N[1];function T(t){E(t),window.docs=t}function I(t,e){return _.apply(this,arguments)}function _(){return(_=Object(p.a)(u.a.mark((function t(e,n){return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=[],t.t1=Object(l.a)(C.slice(0,e)),t.next=4,n(C[e]);case 4:t.t2=t.sent,t.t3=[t.t2],t.t4=Object(l.a)(C.slice(e+1)),T(t.t0.concat.call(t.t0,t.t1,t.t3,t.t4));case 9:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function M(){return(M=Object(p.a)(u.a.mark((function t(){var e,n,c,o;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:k(b+1),e=L[r],n=Object(d.a)(e[b],2),c=n[0],o=n[1],t.t0=c,t.next=t.t0===O?6:t.t0===x?8:t.t0===y?11:t.t0===v?14:17;break;case 6:return R(),t.abrupt("break",18);case 8:return t.next=10,V(o);case 10:return t.abrupt("break",18);case 11:return t.next=13,J(o);case 13:return t.abrupt("break",18);case 14:return t.next=16,U(o);case 16:return t.abrupt("break",18);case 17:throw new Error("Unexpected action: "+c);case 18:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function R(){var t=new f.b,e=new f.d(t);t._prevStateVector=f.h(t);var n=C.length;e.setUserMapping(t,t.clientID,"Doc".concat(n));var c=f.g(t,t._prevStateVector);t._prevStateVector=f.h(t),0!==n&&f.f(t,f.g(C[0].yDoc)),C.forEach((function(t){f.f(t.yDoc,c)})),T([].concat(Object(l.a)(C),[{id:n,yDoc:t,pud:e,updates:[]}]))}function U(t){return B.apply(this,arguments)}function B(){return(B=Object(p.a)(u.a.mark((function t(e){return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.yDoc.destroy(),t.next=3,I(e.id,(function(){return null}));case 3:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function V(t){return P.apply(this,arguments)}function P(){return(P=Object(p.a)(u.a.mark((function t(e){var n,c;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.id,c=e.actions,t.next=3,I(n,function(){var t=Object(p.a)(u.a.mark((function t(e){var n,r,o,a,i,p,d,h,j,b;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=[],r=0;case 2:if(!(r<c.length)){t.next=25;break}o=c[r],a=o.type,i=o.pos,p=o.str,d=o.len,h=e.yDoc.getText(w),t.t0=a,t.next=t.t0===m?9:t.t0===g?11:13;break;case 9:return h.insert(i,p),t.abrupt("break",14);case 11:return h.delete(i,d),t.abrupt("break",14);case 13:throw new Error("Unexpected type");case 14:return t.next=16,A(0);case 16:j=f.g(e.yDoc,e.yDoc._prevStateVector),e.yDoc._prevStateVector=f.h(e.yDoc),(b=Y(e.yDoc.clientID,j)).items.forEach((function(t){"binary"===t.type&&(t.decodedContent=H(t.content),t.content="[...]")})),console.log("update",b),n.push({action:o,payload:j});case 22:r++,t.next=2;break;case 25:if(1!==C.length){t.next=27;break}return t.abrupt("return",e);case 27:return t.abrupt("return",Object(s.a)(Object(s.a)({},e),{},{updates:[].concat(Object(l.a)(e.updates),n)}));case 28:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}());case 3:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function J(t){return W.apply(this,arguments)}function W(){return(W=Object(p.a)(u.a.mark((function t(e){var n,c,r;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.from,c=e.to,r=e.index,t.next=3,I(n,(function(t){if(t){var e=C[c],n=void 0===r?t.updates:[t.updates[r]];return n.forEach((function(t){f.f(e.yDoc,t.payload)})),Object(s.a)(Object(s.a)({},t),{},{updates:t.updates.filter((function(t){return!n.includes(t)}))})}}));case 3:case"end":return t.stop()}}),t)})))).apply(this,arguments)}var z=r===h;return Object(j.jsxs)("div",{className:"App",children:[Object(j.jsx)(D,{scenarios:L,currentScenario:r,currentScenarioStepIndex:b,onScenarioChange:function(t){o(t),k(0),T([])},onNextStep:function(){return M.apply(this,arguments)},onRestartStep:function(){k(0),T([])},onOpenDoc:R}),Object(j.jsx)("div",{className:"docs-container",children:C.filter(Boolean).map((function(t){return Object(j.jsx)(F,{doc:t,docs:C,editable:z,onCloseDoc:U,onEditorChange:V,onSync:J},t.id)}))})]})}a.a.render(Object(j.jsx)(r.a.StrictMode,{children:Object(j.jsx)(Q,{})}),document.getElementById("root"))}},[[52,1,2]]]);
//# sourceMappingURL=main.20b7c2fb.chunk.js.map