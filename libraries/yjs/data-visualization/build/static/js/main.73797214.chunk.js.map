{"version":3,"sources":["enums/enums.js","enums/event-types.js","enums/edit-types.js","components/Scenarios.js","components/Doc/Tab.js","enums/y-doc-keys.js","components/Doc/Editor.js","components/Doc/Updates.js","enums/view-options.js","data-viewer/data-types.js","update-decoder/type-decoder.js","update-decoder/content-decoder.js","update-decoder/delete-set-decoder.js","update-decoder/index.js","data-viewer/json.js","components/Doc/YDocModel/Struct.js","components/Value/index.js","components/Doc/YDocModel/Share.js","components/Doc/YDocModel/Store.js","components/Doc/YDocModel/index.js","components/Doc/index.js","components/Actions/Buttons.js","components/Actions/Options.js","components/Actions/index.js","scenarios/doc-edit.js","scenarios/index.js","scenarios/two-docs-sync-without-conflicts.js","scenarios/two-docs-sync-with-conflicts.js","scenarios/two-docs-sync-with-lost-updates.js","helpers.js","components/ViewOptions.js","App.js","index.js"],"names":["CUSTOM_SCENARIO","DOC_OPEN","DOC_UPDATE","DOC_SYNC","DOC_CLOSE","INSERT","DELETE","stringifyStep","step","event","payload","E","id","actions","map","action","type","EDIT_TYPE","pos","str","len","Error","join","undefined","index","from","to","Scenarios","props","SCENARIOS_ID","currentScenarioSteps","scenarios","currentScenario","currentStep","currentScenarioStepIndex","nextStep","className","htmlFor","onChange","e","target","value","onScenarioChange","ENUMS","Object","keys","scenario","disabled","onClick","length","onNextStep","onRestartStep","Tab","editable","onCloseDoc","doc","yDoc","gc","pud","TEXT_KEY","getActions","prev","cur","cursorPos","diffStart","max","Math","min","i","getDiffStart","diffEnd","getDiffEnd","EDIT_TYPES","slice","getActionByLengthChange","deleted","inserted","push","getTextFromYDoc","getText","Y_DOC_KEYS","toString","Editor","editorRef","useRef","editorValue","useEffect","text","current","textContent","contentEditable","focused","onInput","window","getSelection","getRangeAt","startOffset","onEditorChange","ref","stringifyAction","Updates","createHandleSync","onSync","updates","update","docs","filter","syncedIds","includes","DATA_SOURCES","SHARE","STORE","DOC","ABSTRACT_TYPE","Y_ARRAY","Y_MAP","Y_TEXT","Y_XML_ELEMENT","Y_XML_FRAGMENT","Y_XML_TEXT","ABSTRACT_STRUCT","GC","ITEM","SKIP","CONTENT_ANY","CONTENT_BINARY","CONTENT_DELETED","CONTENT_DOC","CONTENT_EMBED","CONTENT_FORMAT","CONTENT_JSON","CONTENT_STRING","CONTENT_TYPE","typeDecoder","Y","decoder","decoding","contentDecoder","error","DATA_TYPES","content","c","JSON","parse","binary","string","embed","key","contentType","typeRefs","con","readDeleteSet","ds","clients","numClients","client","numberOfDeletes","clock","updateDecoder","clientsStructs","clientRefs","numOfStateUpdates","numberOfStructs","items","readID","info","struct","infoType","AbstractStruct","readItem","readClientsStructRefs","deleteSet","decodeV1","left","origin","right","rightOrigin","parentYKey","parent","this","forEach","canCopyParentInfo","hasParentYKey","itemContent","contentRefs","readItemContent","typeMapToJSON","_map","toJSON","typeArrayToJSON","array","item","_start","handlers","result","share","store","pendingDs","pendingStructs","missing","fromEntries","entries","decodeUpdate","clientID","yArray","yMap","yText","yXmlElement","nodeName","attributes","children","yXmlFragment","yXmlText","xmlText","deletedItemToJSON","contentAny","arr","contentBinary","contentDeleted","contentDoc","contentEmbed","contentFormat","contentJSON","json","contentString","console","assert","constructor","Doc","Array","Map","Text","XmlElement","XmlFragment","XmlText","AbstractType","Item","Skip","ContentAny","ContentBinary","ContentDeleted","ContentEmbed","ContentFormat","ContentJSON","ContentString","ContentType","getDataType","handler","contentRenderers","unsupportedContentType","Struct","isFocusedClientId","getDocByClientId","Collapse","collapsed","ValueString","ValueNumber","number","ValueBoolean","boolean","ValueNull","ValueObject","useState","setCollapsed","object","ValueArray","Value","isArray","name","Share","get","Missing","Clients","_struct","Store","YDocModel","dataSource","focusedDocId","onFocus","Buttons","onOpenDoc","IDS","DEFAULT_GET_VALUE","Options","createHandleChange","getValue","onOptionChange","checked","options","Actions","DocEdit","TwoDocsSyncWithoutConflicts","TwoDocsSyncWithConflicts","TwoDocsSyncWithLostUpdates","sleep","timeout","Promise","resolve","setTimeout","ViewOptions","handleDataSourceChange","VIEW_OPTIONS","label","App","URL","location","href","searchParams","setCurrentScenario","setCurrentScenarioStepIndex","_setDocs","actionOptions","setActionActionOptions","viewOptions","setViewOptions","setFocusedDocId","setDocs","updateDocById","updateDoc","a","handleOpenDoc","handleEditorChange","handleSync","handleCloseDoc","validDocs","Boolean","setUserMapping","destroy","change","newUpdates","prevStateVector","insert","delete","rawDecodedUpdate","decodedUpdate","decodeDeleteSet","decodedContent","log","toDoc","toSyncUpdates","find","getHandleDocFocus","changedOption","ReactDOM","render","StrictMode","document","getElementById"],"mappings":"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CAChBmQ,QDHc,CACd,CAACvR,GACD,CACEA,EACA,CACEC,GAAI,EACJC,QAAS,CACP,CACEG,KAAMwD,EACNtD,IAAK,EACLC,IAAK,UAKb,CACER,EACA,CACEC,GAAI,EACJC,QAAS,CACP,CACEG,KAAMwD,EACNtD,IAAK,EACLE,IAAK,MAKb,CACET,EACA,CACEC,GAAI,EACJC,QAAS,CACP,CACEG,KAAMwD,EACNtD,IAAK,EACLC,IAAK,QAKb,CACER,EACA,CACEC,GAAI,EACJC,QAAS,CACP,CACEG,KAAMwD,EACNtD,IAAK,EACLC,IAAK,SC7CbgR,4BCJkC,CAClC,CAACxR,GACD,CAACA,GACD,CACEA,EACA,CACEC,GAAI,EACJC,QAAS,CACP,CACEG,KAAMwD,EACNtD,IAAK,EACLC,IAAK,UAKb,CACER,EACA,CACEc,KAAM,EACNC,GAAI,IAGR,CACEf,EACA,CACEC,GAAI,EACJC,QAAS,CACP,CACEG,KAAMwD,EACNtD,IAAK,EACLE,IAAK,MAKb,CACET,EACA,CACEC,GAAI,EACJC,QAAS,CACP,CACEG,KAAMwD,EACNtD,IAAK,EACLC,IAAK,QAKb,CACER,EACA,CACEc,KAAM,EACNC,GAAI,KDhDR0Q,yBEL+B,CAC/B,CAACzR,GACD,CAACA,GACD,CACEA,EACA,CACEC,GAAI,EACJC,QAAS,CACP,CACEG,KAAMwD,EACNtD,IAAK,EACLC,IAAK,UAKb,CACER,EACA,CACEc,KAAM,EACNC,GAAI,IAGR,CACEf,EACA,CACEC,GAAI,EACJC,QAAS,CACP,CACEG,KAAMwD,EACNtD,IAAK,EACLC,IAAK,QAKb,CACER,EACA,CACEC,GAAI,EACJC,QAAS,CACP,CACEG,KAAMwD,EACNtD,IAAK,EACLC,IAAK,QAKb,CACER,EACA,CACEc,KAAM,EACNC,GAAI,IAGR,CACEf,EACA,CACEc,KAAM,EACNC,GAAI,KFtDR2Q,2BGNiC,CACjC,CAAC1R,GACD,CAACA,GACD,CACEA,EACA,CACEC,GAAI,EACJC,QAAS,CACP,CACEG,KAAMwD,EACNtD,IAAK,EACLC,IAAK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","file":"static/js/main.73797214.chunk.js","sourcesContent":["/**\n * @since 2021-06-26\n * @author vivaxy\n */\nexport const CUSTOM_SCENARIO = 'CUSTOM_SCENARIO';\n","/**\n * @since 2021-06-24\n * @author vivaxy\n */\nexport const DOC_OPEN = 'DOC_OPEN';\nexport const DOC_UPDATE = 'DOC_UPDATE';\nexport const DOC_SYNC = 'DOC_SYNC';\nexport const DOC_CLOSE = 'DOC_CLOSE';\n","/**\n * @since 2021-06-24\n * @author vivaxy\n */\nexport const INSERT = 'INSERT';\nexport const DELETE = 'DELETE';\n","/**\n * @since 2021-06-25\n * @author vivaxy\n */\nimport * as ENUMS from '../enums/enums';\nimport * as E from '../enums/event-types';\nimport * as EDIT_TYPE from '../enums/edit-types';\n\nimport './Scenarios.css';\n\nfunction stringifyStep(step) {\n  const [event, payload] = step;\n  switch (event) {\n    case E.DOC_OPEN:\n      return event;\n    case E.DOC_UPDATE:\n      const { id, actions } = payload;\n      return actions\n        .map(function (action) {\n          if (action.type === EDIT_TYPE.INSERT) {\n            return `${event} Doc:${id} type:${action.type} pos:${action.pos} str:${action.str}`;\n          }\n          if (action.type === EDIT_TYPE.DELETE) {\n            return `${event} Doc:${id} type:${action.type} pos:${action.pos} len:${action.len}`;\n          }\n          throw new Error('Unexpect edit type: ' + action.type);\n        })\n        .join(' ; ');\n    case E.DOC_SYNC:\n      if (payload.index === undefined) {\n        return `${event} FromDoc:${payload.from} ToDoc:${payload.to}`;\n      }\n      return `${event} FromDoc:${payload.from} ToDoc:${payload.to} updateIndex:${payload.index}`;\n    case E.DOC_CLOSE:\n      return event;\n    default:\n      throw new Error('Expected action: ' + event);\n  }\n}\n\nexport default function Scenarios(props) {\n  const SCENARIOS_ID = 'scenarios';\n\n  function handleChange(e) {\n    if (e.target.value !== props.currentScenario) {\n      props.onScenarioChange(e.target.value);\n    }\n  }\n\n  function handleClick() {\n    const currentScenarioSteps = props.scenarios[props.currentScenario];\n    if (props.currentScenarioStepIndex < currentScenarioSteps.length) {\n      props.onNextStep();\n    } else {\n      props.onRestartStep();\n    }\n  }\n\n  const currentScenarioSteps = props.scenarios[props.currentScenario];\n\n  const currentStep =\n    currentScenarioSteps &&\n    currentScenarioSteps[props.currentScenarioStepIndex - 1];\n\n  const nextStep =\n    currentScenarioSteps &&\n    currentScenarioSteps[props.currentScenarioStepIndex];\n\n  return (\n    <div className=\"scenarios\">\n      <label htmlFor={SCENARIOS_ID}>Scenarios: </label>\n      <select id={SCENARIOS_ID} onChange={handleChange}>\n        <option value={ENUMS.CUSTOM_SCENARIO}>Custom</option>\n        {Object.keys(props.scenarios).map(function (scenario) {\n          return (\n            <option key={scenario} value={scenario}>\n              {scenario}\n            </option>\n          );\n        })}\n      </select>\n      {currentScenarioSteps && (\n        <button\n          disabled={props.currentScenario === ENUMS.CUSTOM_SCENARIO}\n          onClick={handleClick}\n          className=\"next-step-button\"\n        >\n          {nextStep ? 'Next step' : 'Restart'}\n        </button>\n      )}\n      {nextStep && <span className=\"next-step\">{stringifyStep(nextStep)}</span>}\n      {currentStep && (\n        <p className=\"current-step\">\n          <span className=\"current-step-label\">Current step: </span>\n          <span>{stringifyStep(currentStep)}</span>\n        </p>\n      )}\n    </div>\n  );\n}\n","/**\n * @since 2021-06-26\n * @author vivaxy\n */\nimport './Tab.css';\n\nexport default function Tab(props) {\n  function handleCloseDoc() {\n    props.onCloseDoc(props.doc);\n  }\n\n  return (\n    <div className=\"doc-tab\">\n      {props.editable && (\n        <button className=\"doc-close\" onClick={handleCloseDoc}>\n          x\n        </button>\n      )}\n      <p className=\"doc-id\">Doc{props.doc.id}</p>\n      <span className=\"doc-options\">\n        {props.doc.yDoc.gc && <span>GC✔️</span>}\n        {props.doc.pud && <span>PermanentUserData✔️</span>}\n      </span>\n    </div>\n  );\n}\n","/**\n * @since 2021-06-25\n * @author vivaxy\n */\nexport const TEXT_KEY = 'Text';\n","/**\n * @since 2021-06-26\n * @author vivaxy\n */\nimport { useRef, useEffect } from 'react';\nimport * as EDIT_TYPES from '../../enums/edit-types';\nimport * as Y_DOC_KEYS from '../../enums/y-doc-keys';\nimport './Editor.css';\n\nfunction getDiffStart(prev, cur, cursorPos) {\n  const max = Math.min(\n    Math.max(prev.length - 1, 0),\n    Math.max(cur.length - 1, 0),\n    cursorPos,\n  );\n  for (let i = 0; i <= max; i++) {\n    if (prev[i] !== cur[i]) {\n      return i;\n    }\n  }\n  if (prev.length === 0 || cur.length === 0) {\n    return 0;\n  }\n  return max + 1;\n}\n\nfunction getDiffEnd(prev, cur, cursorPos) {\n  const max = Math.min(\n    Math.max(prev.length - 1, 0),\n    Math.max(cur.length - cursorPos, 0),\n  );\n  for (let i = 0; i <= max; i++) {\n    if (prev[prev.length - 1 - i] !== cur[cur.length - 1 - i]) {\n      return i;\n    }\n  }\n  return max;\n}\n\nfunction getActionByLengthChange(prev, cur, cursorPos) {\n  if (prev.length > cur.length) {\n    // delete\n    return {\n      type: EDIT_TYPES.DELETE,\n      pos: cursorPos,\n      len: prev.length - cur.length,\n    };\n  }\n  if (prev.length < cur.length) {\n    // insert\n    const pos = cursorPos - (cur.length - prev.length);\n    return {\n      type: EDIT_TYPES.INSERT,\n      pos,\n      str: cur.slice(pos, cursorPos),\n    };\n  }\n  return null;\n}\n\nfunction getActions(prev, cur, cursorPos) {\n  // 1. text before cursor is added\n  // 2. text after cursor or text before cursor is deleted\n  // 3. ignore changes that result in original text\n  const diffStart = getDiffStart(prev, cur, cursorPos);\n  const diffEnd = getDiffEnd(prev, cur, cursorPos);\n\n  if (\n    diffStart + diffEnd > prev.length - 1 ||\n    diffStart + diffEnd > cur.length - 1\n  ) {\n    // diff collapse\n    // possible same char\n    const action = getActionByLengthChange(prev, cur, cursorPos);\n    if (action) {\n      return [action];\n    }\n    return [];\n  }\n\n  const deleted = {\n    pos: diffStart,\n    len: prev.length - diffEnd - diffStart,\n  };\n  const inserted = {\n    pos: diffStart,\n    str: cur.slice(diffStart, cur.length - diffEnd),\n  };\n  const actions = [];\n  if (deleted.len) {\n    actions.push({\n      type: EDIT_TYPES.DELETE,\n      pos: deleted.pos,\n      len: deleted.len,\n    });\n  }\n  if (inserted.str.length) {\n    actions.push({\n      type: EDIT_TYPES.INSERT,\n      pos: inserted.pos,\n      str: inserted.str,\n    });\n  }\n  return actions;\n}\n\nfunction getTextFromYDoc(yDoc) {\n  return yDoc.getText(Y_DOC_KEYS.TEXT_KEY).toString();\n}\n\nexport default function Editor(props) {\n  const editorRef = useRef(null);\n  const editorValue = useRef(getTextFromYDoc(props.doc.yDoc));\n\n  function handleInput(e) {\n    const value = e.target.textContent;\n    if (editorValue.current !== value) {\n      const cursorPos = window.getSelection().getRangeAt(0).startOffset;\n      const actions = getActions(editorValue.current, value, cursorPos);\n      if (actions.length) {\n        editorValue.current = value;\n        props.onEditorChange({\n          id: props.doc.id,\n          actions,\n        });\n      }\n    }\n  }\n\n  useEffect(function () {\n    const text = getTextFromYDoc(props.doc.yDoc);\n    if (editorRef.current.textContent !== text) {\n      editorRef.current.textContent = text;\n    }\n    if (editorValue.current !== text) {\n      editorValue.current = text;\n    }\n  });\n\n  return (\n    <p\n      contentEditable={props.editable ? 'true' : 'false'}\n      className={`editor ${props.focused ? 'focused' : ''}`}\n      onInput={handleInput}\n      ref={editorRef}\n    />\n  );\n}\n","/**\n * @since 2021-06-26\n * @author vivaxy\n */\nimport * as EDIT_TYPES from '../../enums/edit-types';\nimport './Updates.css';\n\nfunction stringifyAction(action) {\n  return `${action.type} ${action.pos} ${action.str || action.len}`;\n}\n\nexport default function Updates(props) {\n  function createHandleSync(to, index) {\n    return function handleSync() {\n      props.onSync({ from: props.doc.id, to, index });\n    };\n  }\n\n  return (\n    <div className=\"updates\">\n      {props.doc.updates.map(function (update, index) {\n        return (\n          <p className=\"update\" key={index + stringifyAction(update.action)}>\n            <span\n              className={`update-detail${\n                update.action.type === EDIT_TYPES.INSERT ? ' insert' : ' delete'\n              }`}\n            >\n              {stringifyAction(update.action)}\n            </span>\n            {props.editable &&\n              props.docs\n                .filter(function (doc) {\n                  return doc && !update.syncedIds.includes(doc.id);\n                })\n                .map(function (doc) {\n                  return (\n                    <button\n                      className=\"sync-button\"\n                      key={doc.id}\n                      onClick={createHandleSync(doc.id, index)}\n                    >\n                      To Doc{doc.id}\n                    </button>\n                  );\n                })}\n          </p>\n        );\n      })}\n    </div>\n  );\n}\n","/**\n * @since 2021-08-14\n * @author vivaxy\n */\nexport const DATA_SOURCES = {\n  SHARE: 'share',\n  STORE: 'store',\n};\n","/**\n * @since 2021-08-25\n * @author vivaxy\n */\nexport default {\n  // utils\n  DOC: 'Doc',\n\n  // types\n  ABSTRACT_TYPE: 'AbstractType',\n  Y_ARRAY: 'YArray',\n  Y_MAP: 'YMap',\n  Y_TEXT: 'YText',\n  Y_XML_ELEMENT: 'YXmlElement',\n  Y_XML_FRAGMENT: 'YXmlFragment',\n  Y_XML_TEXT: 'YXmlText',\n\n  // structs\n  ABSTRACT_STRUCT: 'AbstractStruct',\n  GC: 'GC',\n  ITEM: 'Item',\n  SKIP: 'Skip',\n\n  // contents\n  CONTENT_ANY: 'ContentAny',\n  CONTENT_BINARY: 'ContentBinary',\n  CONTENT_DELETED: 'ContentDeleted',\n  CONTENT_DOC: 'ContentDoc',\n  CONTENT_EMBED: 'ContentEmbed',\n  CONTENT_FORMAT: 'ContentFormat',\n  CONTENT_JSON: 'ContentJSON',\n  CONTENT_STRING: 'ContentString',\n  CONTENT_TYPE: 'ContentType',\n};\n","/**\n * @since 2021-07-08\n * @author vivaxy\n */\nimport * as Y from 'yjs';\nimport * as decoding from 'lib0/decoding';\n\nconst readYArray = () => {\n  return new Y.Array();\n};\n\nconst readYMap = () => {\n  return new Y.Map();\n};\n\nconst readYText = () => {\n  return new Y.Text();\n};\n\nconst readYXmlElement = (decoder) => {\n  decoding.readVarString(decoder);\n};\n\nconst readYXmlFragment = (decoder) => {};\n\nconst readYXmlHook = (decoder) => {\n  decoding.readVarString(decoder);\n};\n\nconst readYXmlText = (decoder) => {};\n\nconst typeDecoder = [\n  readYArray,\n  readYMap,\n  readYText,\n  readYXmlElement,\n  readYXmlFragment,\n  readYXmlHook,\n  readYXmlText,\n];\n\nexport default typeDecoder;\n","/**\n * @since 2021-07-08\n * @author vivaxy\n */\nimport * as decoding from 'lib0/decoding';\nimport * as error from 'lib0/error';\nimport typeRefs from './type-decoder';\nimport { DATA_TYPES } from '../data-viewer';\n\nfunction readContentDeleted(decoder) {\n  return {\n    type: DATA_TYPES.CONTENT_DELETED,\n    length: decoding.readVarUint(decoder),\n  };\n}\n\nfunction readContentEmbed(decoder) {\n  const embed = decoding.readVarString(decoder);\n  debugger;\n  return {\n    type: DATA_TYPES.CONTENT_EMBED,\n    content: embed,\n    length: 1,\n  };\n}\n\nfunction readContentFormat(decoder) {\n  const key = decoding.readVarString(decoder);\n  const value = decoding.readVarString(decoder);\n  return {\n    type: DATA_TYPES.CONTENT_FORMAT,\n    content: { key, value },\n    length: 1,\n  };\n}\n\nfunction readContentJSON(decoder) {\n  const length = decoding.readVarUint(decoder);\n  const content = [];\n  for (let i = 0; i < length; i++) {\n    const c = decoding.readVarString(decoder);\n    if (c === 'undefined') {\n      content.push(undefined);\n    } else {\n      content.push(JSON.parse(c));\n    }\n  }\n  return {\n    type: DATA_TYPES.CONTENT_JSON,\n    content,\n    length,\n  };\n}\n\nfunction readContentString(decoder) {\n  const string = decoding.readVarString(decoder);\n  return {\n    type: DATA_TYPES.CONTENT_STRING,\n    string,\n    length: string.length,\n  };\n}\n\nfunction readContentType(decoder) {\n  const contentType = typeRefs[decoding.readVarUint(decoder)](decoder);\n  return {\n    type: DATA_TYPES.CONTENT_TYPE,\n    content: contentType,\n    length: 1,\n  };\n}\n\nfunction readContentBinary(decoder) {\n  const binary = decoding.readVarUint8Array(decoder);\n  return {\n    type: DATA_TYPES.CONTENT_BINARY,\n    content: binary,\n    length: 1,\n  };\n}\n\nfunction readContentAny(decoder) {\n  const len = decoding.readVarUint(decoder);\n  const content = [];\n\n  for (let i = 0; i < len; i++) {\n    const con = decoding.readAny(decoder);\n    content.push(con);\n  }\n\n  return {\n    type: DATA_TYPES.CONTENT_ANY,\n    content,\n    length: len,\n  };\n}\n\nconst contentDecoder = [\n  () => {\n    throw error.unexpectedCase();\n  }, // GC is not ItemContent\n  readContentDeleted,\n  readContentJSON,\n  readContentBinary,\n  readContentString,\n  readContentEmbed,\n  readContentFormat,\n  readContentType,\n  readContentAny,\n];\n\nexport default contentDecoder;\n","/**\n * @since 2021-07-08\n * @author vivaxy\n */\nimport * as decoding from 'lib0/decoding';\n\nexport default function readDeleteSet(decoder) {\n  if (!(decoder instanceof decoding.Decoder)) {\n    decoder = decoding.createDecoder(decoder);\n  }\n  const ds = {\n    clients: {},\n  };\n  const numClients = decoding.readVarUint(decoder);\n  for (let i = 0; i < numClients; i++) {\n    const client = decoding.readVarUint(decoder);\n    const numberOfDeletes = decoding.readVarUint(decoder);\n    if (numberOfDeletes > 0) {\n      ds.clients[client] = [];\n      for (let i = 0; i < numberOfDeletes; i++) {\n        ds.clients[client].push({\n          clock: decoding.readVarUint(decoder),\n          length: decoding.readVarUint(decoder),\n        });\n      }\n    }\n  }\n  return ds;\n}\n","/**\n * @since 2021-07-08\n * @author vivaxy\n */\nimport * as decoding from 'lib0/decoding';\nimport * as binary from 'lib0/binary';\nimport contentRefs from './content-decoder';\nimport readDeleteSet from './delete-set-decoder';\nimport { DATA_TYPES } from '../data-viewer';\n\nexport default function updateDecoder(update) {\n  const decoder = decoding.createDecoder(update);\n  // const firstVarUint = decoding.peekVarUint(decoder);\n  // if (firstVarUint === 0) {\n  //   return 'encoding V2 not supported';\n  // } else {\n  return decodeV1(decoder);\n  // }\n}\n\nexport function decodeV1(decoder) {\n  const clientsStructs = readClientsStructRefs(decoder);\n  const deleteSet = readDeleteSet(decoder);\n  return { clientsStructs, deleteSet };\n}\n\nfunction readClientsStructRefs(decoder) {\n  const clientRefs = {};\n  const numOfStateUpdates = decoding.readVarUint(decoder);\n  for (let i = 0; i < numOfStateUpdates; i++) {\n    const numberOfStructs = decoding.readVarUint(decoder);\n    const items = [];\n    let { clock, client } = readID(decoder);\n\n    for (let i = 0; i < numberOfStructs; i++) {\n      const info = decoding.readUint8(decoder);\n      let struct;\n      const infoType = binary.BITS5 & info;\n      if (infoType === 0) {\n        // GC\n        struct = new AbstractStruct(DATA_TYPES.GC, client, clock, {\n          length: decoding.readVarUint(decoder),\n        });\n      } else if (infoType === 10) {\n        // Skip\n        struct = new AbstractStruct(DATA_TYPES.SKIP, client, clock, {\n          length: decoding.readVarUint(decoder),\n        });\n      } else {\n        struct = readItem(client, clock, decoder, info);\n      }\n      items.push(struct);\n      clock += struct.length;\n    }\n    clientRefs[client] = items;\n  }\n  return clientRefs;\n}\n\nfunction readID(decoder) {\n  return {\n    client: decoding.readVarUint(decoder),\n    clock: decoding.readVarUint(decoder),\n  };\n}\n\nclass AbstractStruct {\n  constructor(\n    type,\n    client,\n    clock,\n    content,\n    left,\n    origin,\n    right,\n    rightOrigin,\n    parentYKey,\n    parent,\n  ) {\n    this.type = type;\n    this.client = client;\n    this.clock = clock;\n    this.left = left;\n    this.origin = origin;\n    this.right = right;\n    this.rightOrigin = rightOrigin;\n    this.parentYKey = parentYKey;\n    this.parent = parent;\n    Object.keys(content).forEach((key) => {\n      this[key] = content[key];\n    });\n  }\n}\n\nfunction readItem(client, clock, decoder, info) {\n  const origin = (info & binary.BIT8) === binary.BIT8 ? readID(decoder) : null;\n  const rightOrigin =\n    (info & binary.BIT7) === binary.BIT7 ? readID(decoder) : null;\n  const canCopyParentInfo = (info & (binary.BIT7 | binary.BIT8)) === 0;\n\n  const hasParentYKey = canCopyParentInfo\n    ? decoding.readVarUint(decoder) === 1\n    : false;\n\n  const parentYKey =\n    // parentYKey\n    canCopyParentInfo && hasParentYKey ? decoding.readVarString(decoder) : null;\n\n  let parent = null;\n  if (canCopyParentInfo && !hasParentYKey) {\n    // parent\n    parent = readID(decoder);\n  }\n\n  if (canCopyParentInfo && (info & binary.BIT6) === binary.BIT6) {\n    decoding.readVarString(decoder);\n  }\n\n  const itemContent = readItemContent(decoder, info);\n\n  return new AbstractStruct(\n    DATA_TYPES.ITEM,\n    client,\n    clock,\n    itemContent,\n    null,\n    origin,\n    null,\n    rightOrigin,\n    parentYKey,\n    parent,\n  );\n}\n\nfunction readItemContent(decoder, info) {\n  return contentRefs[info & binary.BITS5](decoder);\n}\n","/**\n * @since 2021-08-09\n * @author vivaxy\n */\nimport DATA_TYPES from './data-types';\nimport decodeUpdate from '../update-decoder';\n\nfunction deletedItemToJSON(item) {\n  if ((item.info & 4) > 0) {\n    return {\n      deleted: true,\n    };\n  }\n  return {};\n}\n\nfunction typeMapToJSON(type, Y) {\n  const map = {};\n  for (const [key, value] of type._map) {\n    map[key] = toJSON(value, Y);\n  }\n  return map;\n}\n\nfunction typeArrayToJSON(type, Y) {\n  const array = [];\n  let item = type._start;\n  while (item !== null) {\n    array.push(toJSON(item, Y));\n    item = item.right;\n  }\n  return array;\n}\n\nconst handlers = {\n  [DATA_TYPES.DOC](doc, Y) {\n    const result = {\n      share: {},\n      store: {\n        clients: {},\n        pendingDs: doc.store.pendingDs,\n        pendingStructs: {\n          missing: Object.fromEntries(\n            doc.store.pendingStructs.missing.entries(),\n          ),\n          update: decodeUpdate(doc.store.pendingStructs.update),\n        },\n      },\n    };\n    for (const [key, value] of doc.share) {\n      result.share[key] = toJSON(value, Y);\n    }\n    for (const [clientID, items] of doc.store.clients) {\n      result.store.clients[clientID] = items.map((item) => toJSON(item, Y));\n    }\n    return result;\n  },\n  [DATA_TYPES.Y_ARRAY](yArray, Y) {\n    return { array: typeArrayToJSON(yArray, Y) };\n  },\n  [DATA_TYPES.Y_MAP](yMap, Y) {\n    return { map: typeMapToJSON(yMap, Y) };\n  },\n  [DATA_TYPES.Y_TEXT](yText, Y) {\n    return { text: typeArrayToJSON(yText, Y) };\n  },\n  [DATA_TYPES.Y_XML_ELEMENT](yXmlElement, Y) {\n    return {\n      nodeName: yXmlElement.nodeName,\n      attributes: typeMapToJSON(yXmlElement, Y),\n      children: typeArrayToJSON(yXmlElement, Y),\n    };\n  },\n  [DATA_TYPES.Y_XML_FRAGMENT](yXmlFragment, Y) {\n    return { children: typeArrayToJSON(yXmlFragment, Y) };\n  },\n  [DATA_TYPES.Y_XML_TEXT](yXmlText, Y) {\n    return { xmlText: typeArrayToJSON(yXmlText, Y) };\n  },\n  [DATA_TYPES.GC](gc) {\n    return {\n      client: gc.id.client,\n      clock: gc.id.clock,\n      length: gc.length,\n    };\n  },\n  [DATA_TYPES.ITEM](item, Y) {\n    return {\n      client: item.id.client,\n      clock: item.id.clock,\n      ...deletedItemToJSON(item),\n      content: toJSON(item.content, Y),\n    };\n  },\n  [DATA_TYPES.CONTENT_ANY](contentAny) {\n    return { value: contentAny.arr };\n  },\n  [DATA_TYPES.CONTENT_BINARY](contentBinary) {\n    return { binary: contentBinary.content };\n  },\n  [DATA_TYPES.CONTENT_DELETED](contentDeleted) {\n    return { length: contentDeleted.len };\n  },\n  [DATA_TYPES.CONTENT_DOC](contentDoc) {\n    return { doc: contentDoc.doc };\n  },\n  [DATA_TYPES.CONTENT_EMBED](contentEmbed) {\n    return { embed: contentEmbed.embed };\n  },\n  [DATA_TYPES.CONTENT_FORMAT](contentFormat) {\n    return { key: contentFormat.key, value: contentFormat.value };\n  },\n  [DATA_TYPES.CONTENT_JSON](contentJSON) {\n    return { json: contentJSON.arr };\n  },\n  [DATA_TYPES.CONTENT_STRING](contentString) {\n    return { string: contentString.str };\n  },\n  [DATA_TYPES.CONTENT_TYPE](contentType, Y) {\n    return { value: toJSON(contentType.type, Y) };\n  },\n};\n\nfunction getDataType(value, Y) {\n  switch (value.constructor) {\n    // utils\n    case Y.Doc:\n      return DATA_TYPES.DOC;\n    // types\n    case Y.Array:\n      return DATA_TYPES.Y_ARRAY;\n    case Y.Map:\n      return DATA_TYPES.Y_MAP;\n    case Y.Text:\n      return DATA_TYPES.Y_TEXT;\n    case Y.XmlElement:\n      return DATA_TYPES.Y_XML_ELEMENT;\n    case Y.XmlFragment:\n      return DATA_TYPES.Y_XML_FRAGMENT;\n    case Y.XmlText:\n      return DATA_TYPES.Y_XML_TEXT;\n    case Y.AbstractType:\n      return DATA_TYPES.ABSTRACT_TYPE;\n    // structs\n    case Y.Item:\n      return DATA_TYPES.ITEM;\n    case Y.GC:\n      return DATA_TYPES.GC;\n    case Y.Skip:\n      return DATA_TYPES.Skip;\n    case Y.AbstractStruct:\n      return DATA_TYPES.ABSTRACT_STRUCT;\n    // contents\n    case Y.ContentAny:\n      return DATA_TYPES.CONTENT_ANY;\n    case Y.ContentBinary:\n      return DATA_TYPES.CONTENT_BINARY;\n    case Y.ContentDeleted:\n      return DATA_TYPES.CONTENT_DELETED;\n    // Skip CONTENT_DOC\n    case Y.ContentEmbed:\n      return DATA_TYPES.CONTENT_EMBED;\n    case Y.ContentFormat:\n      return DATA_TYPES.CONTENT_FORMAT;\n    case Y.ContentJSON:\n      return DATA_TYPES.CONTENT_JSON;\n    case Y.ContentString:\n      return DATA_TYPES.CONTENT_STRING;\n    case Y.ContentType:\n      return DATA_TYPES.CONTENT_TYPE;\n    default:\n      return null;\n  }\n}\n\nexport default function toJSON(value, Y) {\n  console.assert(Y, 'pass Y');\n  const type = getDataType(value, Y);\n  const handler = handlers[type];\n  if (!handler) {\n    return {\n      type: type,\n      error: `Unexpected type ${type}`,\n    };\n  }\n  const json = handler(value, Y);\n  console.assert(json.type === undefined, 'should not include type');\n  return {\n    type: type,\n    ...json,\n  };\n}\n","/**\n * @since 2021-08-14\n * @author vivaxy\n */\nimport { DATA_TYPES } from '../../../data-viewer';\n\nimport './Struct.css';\n\nconst contentRenderers = {\n  [DATA_TYPES.CONTENT_STRING](content) {\n    return <div className=\"string\">{content.string}</div>;\n  },\n  [DATA_TYPES.CONTENT_DELETED](content) {\n    return <div className=\"length\">{content.length}</div>;\n  },\n  [DATA_TYPES.CONTENT_TYPE](content) {\n    return <div className=\"content-type\">{content.value.type}</div>;\n  },\n  [DATA_TYPES.CONTENT_ANY](content) {\n    return <div className=\"content-any\">{content.value}</div>;\n  },\n  [DATA_TYPES.CONTENT_BINARY]() {\n    return <div className=\"content-binary\">Binary</div>;\n  },\n};\n\nfunction unsupportedContentType(content) {\n  return <div>Unsupported content type: {content.type}</div>;\n}\n\nexport default function Struct(props) {\n  const { content, deleted, client, clock } = props.struct;\n  return (\n    <div\n      className={`struct ${content.type} ${\n        deleted || content.type === DATA_TYPES.CONTENT_DELETED ? 'deleted' : ''\n      } ${props.isFocusedClientId(client) ? 'focused' : ''}`}\n    >\n      <div className=\"client\">Doc{props.getDocByClientId(client)?.id}</div>\n      <div className=\"clock\">{clock}</div>\n      {(contentRenderers[content.type] || unsupportedContentType)(content)}\n    </div>\n  );\n}\n","/**\n * @since 2021-08-15\n * @author vivaxy\n */\nimport { useState } from 'react';\nimport './index.css';\n\nfunction Collapse(props) {\n  return (\n    <span\n      className={`collapse ${props.collapsed ? 'collapsed' : ''}`}\n      onClick={props.onClick}\n    />\n  );\n}\n\nfunction ValueString(props) {\n  return <span className=\"value string\">\"{props.string}\"</span>;\n}\n\nfunction ValueNumber(props) {\n  return <span className=\"value number\">{props.number}</span>;\n}\n\nfunction ValueBoolean(props) {\n  return <span className=\"value boolean\">{props.boolean}</span>;\n}\n\nfunction ValueNull(props) {\n  return <span className=\"value null\">{props.value}</span>;\n}\n\nfunction ValueObject(props) {\n  const [collapsed, setCollapsed] = useState(true);\n\n  function handleCollapseClick() {\n    setCollapsed(!collapsed);\n  }\n\n  const keys = Object.keys(props.object);\n  return (\n    <span className=\"value object\">\n      <span className=\"object-description\">\n        <Collapse collapsed={collapsed} onClick={handleCollapseClick} />\n        <span className=\"description\">{`Object()`}</span>\n      </span>\n      {!collapsed &&\n        keys.map(function (key) {\n          return (\n            <div className=\"object-item\" key={key}>\n              <span className=\"object-key\">{key}</span>\n              <span>:</span>\n              <span className=\"object-value\">\n                <Value value={props.object[key]} />\n              </span>\n            </div>\n          );\n        })}\n    </span>\n  );\n}\n\nfunction ValueArray(props) {\n  const [collapsed, setCollapsed] = useState(true);\n\n  function handleCollapseClick() {\n    setCollapsed(!collapsed);\n  }\n\n  return (\n    <div className=\"value array\">\n      <div className=\"array-description\">\n        <Collapse collapsed={collapsed} onClick={handleCollapseClick} />\n        <span>{`Array(${props.array.length})`}</span>\n      </div>\n      {!collapsed &&\n        props.array.map(function (item, index) {\n          return (\n            <div className=\"array-item\" key={index}>\n              <span className=\"array-key\">{index}</span>\n              <span>:</span>\n              <span className=\"array-value\">\n                <Value value={props.array[index]} />\n              </span>\n            </div>\n          );\n        })}\n    </div>\n  );\n}\n\nexport default function Value(props) {\n  if (typeof props.value === 'string') {\n    return <ValueString string={props.value} />;\n  }\n  if (typeof props.value === 'number') {\n    return <ValueNumber number={props.value} />;\n  }\n  if (typeof props.value === 'boolean') {\n    return <ValueBoolean boolean={props.value} />;\n  }\n  if (props.value === null || props.value === undefined) {\n    return <ValueNull value={props.value} />;\n  }\n  if (Array.isArray(props.value)) {\n    return <ValueArray array={props.value} />;\n  }\n  return <ValueObject object={props.value} />;\n}\n","/**\n * @since 2021-08-14\n * @author vivaxy\n */\nimport * as Y from 'yjs';\nimport { toJSON, DATA_TYPES } from '../../../data-viewer';\nimport Struct from './Struct';\nimport Value from '../../Value';\n\nimport './Share.css';\n\nfunction AbstractType(props) {\n  const value = toJSON(props.value, Y);\n  if (value.type === DATA_TYPES.Y_TEXT) {\n    return (\n      <div className=\"abstract-type\">\n        <div className=\"abstract-type-name\">{props.name}:</div>\n        <div className=\"abstract-type-value\">\n          {value.text.map(function (struct) {\n            return (\n              <Struct\n                key={`${struct.client}-${struct.clock}`}\n                struct={struct}\n                isFocusedClientId={props.isFocusedClientId}\n                getDocByClientId={props.getDocByClientId}\n              />\n            );\n          })}\n        </div>\n      </div>\n    );\n  }\n  return <Value value={value} />;\n}\n\nexport default function Share(props) {\n  const keys = Array.from(props.yDoc.share.keys());\n  return (\n    <div className=\"data-source-share\">\n      {keys.map(function (name) {\n        return (\n          <AbstractType\n            key={name}\n            name={name}\n            value={props.yDoc.share.get(name)}\n            getDocByClientId={props.getDocByClientId}\n            isFocusedClientId={props.isFocusedClientId}\n          />\n        );\n      })}\n    </div>\n  );\n}\n","/**\n * @since 2021-08-14\n * @author vivaxy\n */\nimport * as Y from 'yjs';\nimport Struct from './Struct';\nimport { toJSON } from '../../../data-viewer';\n\nimport './Store.css';\n\nfunction Missing(props) {\n  return Array.from(props.missing.keys()).map(function (clientID) {\n    return (\n      <p key={clientID}>\n        <span className=\"client-id\">{clientID}:</span>\n        <span>{props.missing.get(clientID)}</span>\n      </p>\n    );\n  });\n}\n\nfunction Clients(props) {\n  return Array.from(props.clients.keys()).map(function (clientID) {\n    return (\n      <div className=\"client-container\" key={clientID}>\n        <div className=\"client-id\">clientID: {clientID}</div>\n        <div className=\"client-structs\">\n          {props.clients.get(clientID).map(function (_struct) {\n            const struct = toJSON(_struct, Y);\n            return (\n              <Struct\n                key={`${struct.client}-${struct.clock}`}\n                struct={struct}\n                isFocusedClientId={props.isFocusedClientId}\n                getDocByClientId={props.getDocByClientId}\n              />\n            );\n          })}\n        </div>\n      </div>\n    );\n  });\n}\n\nexport default function Store(props) {\n  return (\n    <div className=\"data-source-store\">\n      {props.yDoc.store.pendingStructs && (\n        <div className=\"pending-structs\">\n          <p>Missing:</p>\n          <Missing missing={props.yDoc.store.pendingStructs.missing} />\n        </div>\n      )}\n      <Clients\n        clients={props.yDoc.store.clients}\n        isFocusedClientId={props.isFocusedClientId}\n        getDocByClientId={props.getDocByClientId}\n      />\n    </div>\n  );\n}\n","/**\n * @since 2021-06-25\n * @author vivaxy\n */\nimport { DATA_SOURCES } from '../../../enums/view-options';\nimport Share from './Share';\nimport Store from './Store';\n\nimport './index.css';\n\nexport default function YDocModel(props) {\n  return (\n    <div className=\"y-doc-model\">\n      {props.dataSource === DATA_SOURCES.SHARE ? (\n        <Share\n          yDoc={props.yDoc}\n          getDocByClientId={props.getDocByClientId}\n          isFocusedClientId={props.isFocusedClientId}\n        />\n      ) : (\n        <Store\n          yDoc={props.yDoc}\n          getDocByClientId={props.getDocByClientId}\n          isFocusedClientId={props.isFocusedClientId}\n        />\n      )}\n    </div>\n  );\n}\n","/**\n * @since 2021-06-25\n * @author vivaxy\n */\nimport Tab from './Tab';\nimport Editor from './Editor';\nimport Updates from './Updates';\nimport Index from './YDocModel';\nimport './index.css';\n\nexport default function Doc(props) {\n  function isFocusedClientId(clientID) {\n    const doc = props.getDocByClientId(clientID);\n    return doc?.id === props.focusedDocId;\n  }\n\n  return (\n    <div className=\"doc-container\" onClick={props.onFocus}>\n      <Tab\n        doc={props.doc}\n        onCloseDoc={props.onCloseDoc}\n        editable={props.editable}\n      />\n      <Editor\n        doc={props.doc}\n        onEditorChange={props.onEditorChange}\n        editable={props.editable}\n        focused={isFocusedClientId(props.doc.yDoc.clientID)}\n      />\n      <Updates\n        doc={props.doc}\n        docs={props.docs}\n        onSync={props.onSync}\n        editable={props.editable}\n      />\n      <Index\n        yDoc={props.doc.yDoc}\n        dataSource={props.dataSource}\n        getDocByClientId={props.getDocByClientId}\n        isFocusedClientId={isFocusedClientId}\n      />\n    </div>\n  );\n}\n","/**\n * @since 2021-06-25\n * @author vivaxy\n */\nexport default function Buttons(props) {\n  function handleOpenDoc() {\n    props.onOpenDoc();\n  }\n\n  return (\n    <span className=\"buttons-container\">\n      <span>Actions: </span>\n      <button onClick={handleOpenDoc}>Open a new doc</button>\n    </span>\n  );\n}\n","/**\n * @since 2021-07-16\n * @author vivaxy\n */\nimport './Options.css';\n\nconst IDS = {\n  GC: 'option-gc',\n  PUD: 'option-pud',\n};\n\nfunction DEFAULT_GET_VALUE(e) {\n  return e.target.value;\n}\n\nexport default function Options(props) {\n  function createHandleChange(key, getValue = DEFAULT_GET_VALUE) {\n    return function handleChange(e) {\n      props.onOptionChange({\n        [key]: getValue(e),\n      });\n    };\n  }\n\n  return (\n    <span className=\"options-container\">\n      <label htmlFor={IDS.GC}>GC:</label>\n      <input\n        id={IDS.GC}\n        type=\"checkbox\"\n        checked={props.options.gc}\n        onChange={createHandleChange('gc', function (e) {\n          return e.target.checked;\n        })}\n      />\n      <label htmlFor={IDS.PUD}>PermanentUserData:</label>\n      <input\n        id={IDS.PUD}\n        type=\"checkbox\"\n        checked={props.options.pud}\n        onChange={createHandleChange('pud', function (e) {\n          return e.target.checked;\n        })}\n      />\n    </span>\n  );\n}\n","/**\n * @since 2021-07-13\n * @author vivaxy\n */\nimport Buttons from './Buttons';\nimport Options from './Options';\n\nexport default function Actions(props) {\n  return (\n    <div className=\"actions-container\">\n      <Buttons onOpenDoc={props.onOpenDoc} />\n      <Options options={props.options} onOptionChange={props.onOptionChange} />\n    </div>\n  );\n}\n","/**\n * @since 2021-06-25\n * @author vivaxy\n */\nimport * as E from '../enums/event-types.js';\nimport * as EDIT_TYPES from '../enums/edit-types.js';\n\nconst DocEdit = [\n  [E.DOC_OPEN],\n  [\n    E.DOC_UPDATE,\n    {\n      id: 0,\n      actions: [\n        {\n          type: EDIT_TYPES.INSERT,\n          pos: 0,\n          str: 'FOO',\n        },\n      ],\n    },\n  ],\n  [\n    E.DOC_UPDATE,\n    {\n      id: 0,\n      actions: [\n        {\n          type: EDIT_TYPES.DELETE,\n          pos: 1,\n          len: 1,\n        },\n      ],\n    },\n  ],\n  [\n    E.DOC_UPDATE,\n    {\n      id: 0,\n      actions: [\n        {\n          type: EDIT_TYPES.INSERT,\n          pos: 1,\n          str: 'T',\n        },\n      ],\n    },\n  ],\n  [\n    E.DOC_UPDATE,\n    {\n      id: 0,\n      actions: [\n        {\n          type: EDIT_TYPES.INSERT,\n          pos: 1,\n          str: 'B',\n        },\n      ],\n    },\n  ],\n];\n\nexport default DocEdit;\n","/**\n * @since 2021-06-25\n * @author vivaxy\n */\nimport DocEdit from './doc-edit';\nimport TwoDocsSyncWithoutConflicts from './two-docs-sync-without-conflicts.js';\nimport TwoDocsSyncWithConflicts from './two-docs-sync-with-conflicts.js';\nimport TwoDocsSyncWithLostUpdates from './two-docs-sync-with-lost-updates.js';\n\nconst scenarios = {\n  DocEdit,\n  TwoDocsSyncWithoutConflicts,\n  TwoDocsSyncWithConflicts,\n  TwoDocsSyncWithLostUpdates,\n};\n\nexport default scenarios;\n","/**\n * @since 2021-06-25\n * @author vivaxy\n */\nimport * as E from '../enums/event-types.js';\nimport * as EDIT_TYPES from '../enums/edit-types.js';\n\nconst TwoDocsSyncWithoutConflicts = [\n  [E.DOC_OPEN],\n  [E.DOC_OPEN],\n  [\n    E.DOC_UPDATE,\n    {\n      id: 0,\n      actions: [\n        {\n          type: EDIT_TYPES.INSERT,\n          pos: 0,\n          str: 'FOO',\n        },\n      ],\n    },\n  ],\n  [\n    E.DOC_SYNC,\n    {\n      from: 0,\n      to: 1,\n    },\n  ],\n  [\n    E.DOC_UPDATE,\n    {\n      id: 1,\n      actions: [\n        {\n          type: EDIT_TYPES.DELETE,\n          pos: 1,\n          len: 1,\n        },\n      ],\n    },\n  ],\n  [\n    E.DOC_UPDATE,\n    {\n      id: 1,\n      actions: [\n        {\n          type: EDIT_TYPES.INSERT,\n          pos: 1,\n          str: 'T',\n        },\n      ],\n    },\n  ],\n  [\n    E.DOC_SYNC,\n    {\n      from: 1,\n      to: 0,\n    },\n  ],\n];\n\nexport default TwoDocsSyncWithoutConflicts;\n","/**\n * @since 2021-06-25\n * @author vivaxy\n */\nimport * as E from '../enums/event-types.js';\nimport * as EDIT_TYPES from '../enums/edit-types.js';\n\nconst TwoDocsSyncWithConflicts = [\n  [E.DOC_OPEN],\n  [E.DOC_OPEN],\n  [\n    E.DOC_UPDATE,\n    {\n      id: 0,\n      actions: [\n        {\n          type: EDIT_TYPES.INSERT,\n          pos: 0,\n          str: 'FOO',\n        },\n      ],\n    },\n  ],\n  [\n    E.DOC_SYNC,\n    {\n      from: 0,\n      to: 1,\n    },\n  ],\n  [\n    E.DOC_UPDATE,\n    {\n      id: 0,\n      actions: [\n        {\n          type: EDIT_TYPES.INSERT,\n          pos: 3,\n          str: 'B',\n        },\n      ],\n    },\n  ],\n  [\n    E.DOC_UPDATE,\n    {\n      id: 1,\n      actions: [\n        {\n          type: EDIT_TYPES.INSERT,\n          pos: 3,\n          str: 'T',\n        },\n      ],\n    },\n  ],\n  [\n    E.DOC_SYNC,\n    {\n      from: 1,\n      to: 0,\n    },\n  ],\n  [\n    E.DOC_SYNC,\n    {\n      from: 0,\n      to: 1,\n    },\n  ],\n];\n\nexport default TwoDocsSyncWithConflicts;\n","/**\n * @since 2021-06-25\n * @author vivaxy\n */\nimport * as E from '../enums/event-types.js';\nimport * as EDIT_TYPES from '../enums/edit-types.js';\n\nconst TwoDocsSyncWithLostUpdates = [\n  [E.DOC_OPEN],\n  [E.DOC_OPEN],\n  [\n    E.DOC_UPDATE,\n    {\n      id: 0,\n      actions: [\n        {\n          type: EDIT_TYPES.INSERT,\n          pos: 0,\n          str: 'FOO',\n        },\n      ],\n    },\n  ],\n  [\n    E.DOC_SYNC,\n    {\n      from: 0,\n      to: 1,\n    },\n  ],\n  [\n    E.DOC_UPDATE,\n    {\n      id: 0,\n      actions: [\n        {\n          type: EDIT_TYPES.INSERT,\n          pos: 3,\n          str: 'B',\n        },\n      ],\n    },\n  ],\n  [\n    E.DOC_UPDATE,\n    {\n      id: 0,\n      actions: [\n        {\n          type: EDIT_TYPES.INSERT,\n          pos: 4,\n          str: 'AR',\n        },\n      ],\n    },\n  ],\n  [\n    E.DOC_UPDATE,\n    {\n      id: 1,\n      actions: [\n        {\n          type: EDIT_TYPES.INSERT,\n          pos: 3,\n          str: 'T',\n        },\n      ],\n    },\n  ],\n  [\n    E.DOC_SYNC,\n    {\n      from: 0,\n      to: 1,\n      index: 1,\n    },\n  ],\n  [\n    E.DOC_SYNC,\n    {\n      from: 1,\n      to: 0,\n    },\n  ],\n  [\n    E.DOC_SYNC,\n    {\n      from: 0,\n      to: 1,\n      index: 0,\n    },\n  ],\n];\n\nexport default TwoDocsSyncWithLostUpdates;\n","/**\n * @since 2021-07-08\n * @author vivaxy\n */\nexport function sleep(timeout) {\n  return new Promise(function (resolve) {\n    setTimeout(resolve, timeout);\n  });\n}\n","/**\n * @since 2021-08-14\n * @author vivaxy\n */\nimport * as VIEW_OPTIONS from '../enums/view-options';\n\nexport default function ViewOptions(props) {\n  function handleDataSourceChange(e) {\n    props.onOptionChange({\n      dataSource: e.target.value,\n    });\n  }\n\n  return (\n    <div className=\"view-options-container\">\n      <label>Data source:</label>\n      {[\n        {\n          id: VIEW_OPTIONS.DATA_SOURCES.SHARE,\n          label: 'Share',\n        },\n        {\n          id: VIEW_OPTIONS.DATA_SOURCES.STORE,\n          label: 'Store',\n        },\n      ].map(function (item) {\n        return (\n          <span key={item.id}>\n            <input\n              id={item.id}\n              type=\"radio\"\n              value={item.id}\n              checked={props.options.dataSource === item.id}\n              onChange={handleDataSourceChange}\n            />\n            <label htmlFor={item.id}>{item.label}</label>\n          </span>\n        );\n      })}\n    </div>\n  );\n}\n","import { useState } from 'react';\nimport * as Y from 'yjs';\n\nimport Scenarios from './components/Scenarios';\nimport Doc from './components/Doc/index';\nimport Actions from './components/Actions/index';\nimport scenarios from './scenarios';\nimport * as EDIT_TYPE from './enums/edit-types';\nimport * as Y_DOC_KEYS from './enums/y-doc-keys';\nimport * as E from './enums/event-types.js';\nimport * as ENUMS from './enums/enums';\nimport { sleep } from './helpers';\nimport decodeUpdate from './update-decoder';\nimport decodeDeleteSet from './update-decoder/delete-set-decoder';\nimport ViewOptions from './components/ViewOptions';\nimport * as VIEW_OPTIONS from './enums/view-options';\n\nimport './App.css';\n\nconst SCENARIO_QUERY_KEY = 'scenario';\n\nfunction getURLQuery(key) {\n  const url = new URL(window.location.href);\n  const searchParams = url.searchParams;\n  return searchParams.get(key);\n}\n\nexport default function App() {\n  // url like ?scenario=TwoDocsSyncWithoutConflicts\n  const [currentScenario, setCurrentScenario] = useState(\n    getURLQuery(SCENARIO_QUERY_KEY) || ENUMS.CUSTOM_SCENARIO,\n  );\n  const [currentScenarioStepIndex, setCurrentScenarioStepIndex] = useState(0);\n  const [docs, _setDocs] = useState([]);\n  const [actionOptions, setActionActionOptions] = useState({\n    gc: false,\n    pud: false,\n  });\n  const [viewOptions, setViewOptions] = useState({\n    dataSource: VIEW_OPTIONS.DATA_SOURCES.SHARE,\n  });\n  const [focusedDocId, setFocusedDocId] = useState(null);\n\n  function setDocs(docs) {\n    _setDocs(docs);\n    window.docs = docs;\n  }\n\n  async function updateDocById(id, updateDoc) {\n    const newDocs = [\n      ...docs.slice(0, id),\n      await updateDoc(docs[id]),\n      ...docs.slice(id + 1),\n    ];\n    setDocs(newDocs);\n  }\n\n  function handleScenarioChange(scenario) {\n    setCurrentScenario(scenario);\n    setCurrentScenarioStepIndex(0);\n    setDocs([]);\n  }\n\n  async function handleNextStep() {\n    setCurrentScenarioStepIndex(currentScenarioStepIndex + 1);\n    const currentScenarioSteps = scenarios[currentScenario];\n    const [action, payload] = currentScenarioSteps[currentScenarioStepIndex];\n    switch (action) {\n      case E.DOC_OPEN:\n        await handleOpenDoc();\n        break;\n      case E.DOC_UPDATE:\n        await handleEditorChange(payload);\n        break;\n      case E.DOC_SYNC:\n        await handleSync(payload);\n        break;\n      case E.DOC_CLOSE:\n        await handleCloseDoc(payload);\n        break;\n      default:\n        throw new Error('Unexpected action: ' + action);\n    }\n  }\n\n  function handleRestartStep() {\n    setCurrentScenarioStepIndex(0);\n    setDocs([]);\n  }\n\n  async function handleOpenDoc() {\n    const yDoc = new Y.Doc();\n    yDoc.gc = actionOptions.gc;\n    const id = docs.length;\n\n    // when create doc, sync from the first doc\n    const validDocs = docs.filter(Boolean);\n    if (validDocs.length && id !== validDocs[0].id) {\n      Y.applyUpdate(yDoc, Y.encodeStateAsUpdate(validDocs[0].yDoc));\n    }\n\n    // applyUpdate should occur before pud\n    let pud = null;\n    if (actionOptions.pud) {\n      pud = new Y.PermanentUserData(yDoc);\n      /**\n       * cannot put setUserMapping and applyUpdate in one transaction\n       * setUserMapping comes from local but applyUpdate comes from remote\n       */\n      pud.setUserMapping(yDoc, yDoc.clientID, `Doc${id}`);\n      // setUserMapping use setTimeout to update pud\n      await sleep(0);\n    }\n\n    // sync to other docs\n    const update = Y.encodeStateAsUpdate(yDoc);\n    validDocs.forEach(function (doc) {\n      Y.applyUpdate(doc.yDoc, update);\n    });\n    setDocs([\n      ...docs,\n      {\n        id,\n        yDoc, // mutable\n        pud,\n        updates: [], // { action, payload }\n      },\n    ]);\n  }\n\n  async function handleCloseDoc(doc) {\n    doc.yDoc.destroy();\n    await updateDocById(doc.id, function () {\n      return null;\n    });\n  }\n\n  async function handleEditorChange(change) {\n    const { id, actions } = change;\n    await updateDocById(id, async function (doc) {\n      let newUpdates = [];\n      const prevStateVector = Y.encodeStateVector(doc.yDoc);\n      for (let i = 0; i < actions.length; i++) {\n        const action = actions[i];\n        const { type, pos, str, len } = action;\n        const yText = doc.yDoc.getText(Y_DOC_KEYS.TEXT_KEY);\n        switch (type) {\n          case EDIT_TYPE.INSERT:\n            yText.insert(pos, str);\n            break;\n          case EDIT_TYPE.DELETE:\n            yText.delete(pos, len);\n            break;\n          default:\n            throw new Error('Unexpected type');\n        }\n        await sleep(0);\n        const update = Y.encodeStateAsUpdate(doc.yDoc, prevStateVector);\n        const rawDecodedUpdate = decodeUpdate(update);\n        const decodedUpdate = {\n          items: rawDecodedUpdate.clientsStructs[doc.yDoc.clientID] || [],\n          deleteSet:\n            rawDecodedUpdate.deleteSet.clients[doc.yDoc.clientID] || [],\n        };\n        decodedUpdate.items.forEach(function (item) {\n          if (item.type === 'binary') {\n            const deleteSet = decodeDeleteSet(item.content);\n            if (Object.keys(deleteSet).length) {\n              item.decodedContent = deleteSet;\n            }\n            item.content = '[...]';\n          }\n        });\n        console.log('update', decodedUpdate);\n        newUpdates.push({\n          action,\n          payload: update,\n          syncedIds: [id],\n        });\n      }\n      if (docs.length === 1) {\n        // do not record updates when there is only one doc.\n        return doc;\n      }\n      return {\n        ...doc,\n        updates: [...doc.updates, ...newUpdates],\n      };\n    });\n  }\n\n  async function handleSync({ from, to, index }) {\n    await updateDocById(from, function (doc) {\n      if (!doc) {\n        return;\n      }\n      const toDoc = docs[to];\n      const toSyncUpdates =\n        index === undefined ? doc.updates : [doc.updates[index]];\n      toSyncUpdates.forEach(function (update) {\n        Y.applyUpdate(toDoc.yDoc, update.payload);\n      });\n      return {\n        ...doc,\n        updates: doc.updates\n          .map(function (update) {\n            if (toSyncUpdates.includes(update)) {\n              if (update.syncedIds.includes(to)) {\n                return update;\n              }\n              return {\n                ...update,\n                syncedIds: [...update.syncedIds, to],\n              };\n            }\n            return update;\n          })\n          .filter(function (update) {\n            return update.syncedIds.length !== docs.filter(Boolean).length;\n          }),\n      };\n    });\n  }\n\n  function handleActionOptionChange(changedOption) {\n    setActionActionOptions({\n      ...actionOptions,\n      ...changedOption,\n    });\n  }\n\n  function handleViewOptionChange(changedOption) {\n    setViewOptions({\n      ...viewOptions,\n      ...changedOption,\n    });\n  }\n\n  function getDocByClientId(clientID) {\n    return docs.find(function (doc) {\n      return doc && doc.yDoc.clientID === clientID;\n    });\n  }\n\n  function getHandleDocFocus(doc) {\n    return function handleDocFocus() {\n      setFocusedDocId(doc.id);\n    };\n  }\n\n  const editable = currentScenario === ENUMS.CUSTOM_SCENARIO;\n\n  return (\n    <div className=\"App\">\n      <Scenarios\n        scenarios={scenarios}\n        currentScenario={currentScenario}\n        currentScenarioStepIndex={currentScenarioStepIndex}\n        onScenarioChange={handleScenarioChange}\n        onNextStep={handleNextStep}\n        onRestartStep={handleRestartStep}\n        onOpenDoc={handleOpenDoc}\n      />\n      {!scenarios[currentScenario] && (\n        <Actions\n          onOpenDoc={handleOpenDoc}\n          options={actionOptions}\n          onOptionChange={handleActionOptionChange}\n        />\n      )}\n      <ViewOptions\n        options={viewOptions}\n        onOptionChange={handleViewOptionChange}\n      />\n      <div className=\"docs-container\">\n        {docs.filter(Boolean).map(function (doc) {\n          return (\n            <Doc\n              key={doc.id}\n              doc={doc}\n              docs={docs}\n              editable={editable}\n              dataSource={viewOptions.dataSource}\n              onCloseDoc={handleCloseDoc}\n              onEditorChange={handleEditorChange}\n              onSync={handleSync}\n              getDocByClientId={getDocByClientId}\n              onFocus={getHandleDocFocus(doc)}\n              focusedDocId={focusedDocId}\n            />\n          );\n        })}\n      </div>\n    </div>\n  );\n}\n","/**\n * @author vivaxy\n * @since 2021-07-08\n */\n\nimport React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root'),\n);\n"],"sourceRoot":""}