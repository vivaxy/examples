(this["webpackJsonpdata-visualization"]=this["webpackJsonpdata-visualization"]||[]).push([[0],{33:function(t,e,n){},34:function(t,e,n){},36:function(t,e,n){},37:function(t,e,n){},38:function(t,e,n){},39:function(t,e,n){},40:function(t,e,n){},41:function(t,e,n){},42:function(t,e,n){},50:function(t,e,n){"use strict";n.r(e);var c=n(15),o=n.n(c),r=n(27),s=n.n(r),a=(n(33),n(16)),i=n(12),d=n(11),l=n(19),u="CUSTOM_SCENARIO",p=(n(34),n(4));function j(t){return Object(p.jsxs)("div",{className:"actions",children:[Object(p.jsx)("span",{children:"Actions: "}),Object(p.jsx)("button",{onClick:t.onOpenDoc,children:"Open a new doc"})]})}var f="DOC_OPEN",h="DOC_UPDATE",b="DOC_SYNC",O="DOC_CLOSE",x="INSERT",m="DELETE";n(36);function y(t){var e=Object(d.a)(t,2),n=e[0],c=e[1];switch(n){case f:return n;case h:var o=c.id;return c.actions.map((function(t){if(t.type===x)return"".concat(n," Doc:").concat(o," type:").concat(t.type," pos:").concat(t.pos," str:").concat(t.str);if(t.type===m)return"".concat(n," Doc:").concat(o," type:").concat(t.type," pos:").concat(t.pos," len:").concat(t.len);throw new Error("Unexpect edit type: "+t.type)})).join(" ; ");case b:return void 0===c.index?"".concat(n," FromDoc:").concat(c.from," ToDoc:").concat(c.to):"".concat(n," FromDoc:").concat(c.from," ToDoc:").concat(c.to," updateIndex:").concat(c.index);case O:return n;default:throw new Error("Expected action: "+n)}}function v(t){var e="scenarios";var n=t.scenarios[t.currentScenario],c=n&&n[t.currentScenarioStepIndex-1],o=n&&n[t.currentScenarioStepIndex];return Object(p.jsxs)("div",{className:"scenarios",children:[Object(p.jsx)("label",{htmlFor:e,children:"Scenarios: "}),Object(p.jsxs)("select",{id:e,onChange:function(e){e.target.value!==t.currentScenario&&t.onScenarioChange(e.target.value)},children:[Object(p.jsx)("option",{value:u,children:"Custom"}),Object.keys(t.scenarios).map((function(t){return Object(p.jsx)("option",{value:t,children:t},t)}))]}),n&&Object(p.jsx)("button",{disabled:t.currentScenario===u,onClick:function(){var e=t.scenarios[t.currentScenario];t.currentScenarioStepIndex<e.length?t.onNextStep():t.onRestartStep()},className:"next-step-button",children:o?"Next step":"Restart"}),o&&Object(p.jsx)("span",{className:"next-step",children:y(o)}),c&&Object(p.jsxs)("p",{className:"current-step",children:[Object(p.jsx)("span",{className:"current-step-label",children:"Current step: "}),Object(p.jsx)("span",{children:y(c)})]}),!n&&Object(p.jsx)(j,{onOpenDoc:function(){t.onOpenDoc()}})]})}n(37);function g(t){return Object(p.jsxs)("div",{className:"doc-tab",children:[Object(p.jsxs)("p",{className:"doc-id",children:["Doc",t.doc.id]}),Object(p.jsx)("button",{className:"doc-close",onClick:function(){t.onCloseDoc(t.doc)},children:"x"})]})}var D="sample-key";n(38);function S(t,e,n){var c=function(t,e,n){for(var c=Math.min(Math.max(t.length-1,0),Math.max(e.length-1,0),n),o=0;o<=c;o++)if(t[o]!==e[o])return o;return 0===t.length||0===e.length?0:c+1}(t,e,n),o=function(t,e,n){for(var c=Math.min(Math.max(t.length-1,0),Math.max(e.length-n,0)),o=0;o<=c;o++)if(t[t.length-1-o]!==e[e.length-1-o])return o;return c}(t,e,n);if(c+o>t.length-1||c+o>e.length-1){var r=function(t,e,n){if(t.length>e.length)return{type:m,pos:n,len:t.length-e.length};if(t.length<e.length){var c=n-(e.length-t.length);return{type:x,pos:c,str:e.slice(c,n)}}return null}(t,e,n);return r?[r]:[]}var s={pos:c,len:t.length-o-c},a={pos:c,str:e.slice(c,e.length-o)},i=[];return s.len&&i.push({type:m,pos:s.pos,len:s.len}),a.str.length&&i.push({type:x,pos:a.pos,str:a.str}),i}function N(t){return t.getText(D).toString()}function C(t){var e=Object(c.useRef)(null),n=Object(c.useRef)(N(t.doc.yDoc));return Object(c.useEffect)((function(){var c=N(t.doc.yDoc);e.current.textContent!==c&&(e.current.textContent=c),n.current!==c&&(n.current=c)})),Object(p.jsx)("p",{contentEditable:t.editable?"true":"false",className:"editor",onInput:function(e){var c=e.target.textContent;if(n.current!==c){var o=window.getSelection().getRangeAt(0).startOffset,r=S(n.current,c,o);r.length&&(n.current=c,t.onEditorChange({id:t.doc.id,actions:r}))}},ref:e})}n(39);function w(t){return"".concat(t.type," ").concat(t.pos," ").concat(t.str||t.len)}function E(t){function e(e,n){return function(){t.onSync({from:t.doc.id,to:e,index:n})}}return Object(p.jsx)("div",{className:"updates",children:t.doc.updates.map((function(n,c){return Object(p.jsxs)("p",{className:"update",children:[Object(p.jsx)("span",{className:"update-detail".concat(n.action.type===x?" insert":" delete"),children:w(n.action)}),t.editable&&t.docs.filter((function(e){return e&&e.id!==t.doc.id})).map((function(t){return Object(p.jsxs)("button",{className:"sync-button",onClick:e(t.id,c),children:["To Doc",t.id]},t.id)}))]},c+w(n.action))}))})}n(40);function k(t){var e=[];return t.forEach((function(t,n){e.push(Object(p.jsxs)("p",{children:[Object(p.jsxs)("span",{className:"client-id",children:[n,":"]}),Object(p.jsx)("span",{children:t})]},n))})),e}function T(t,e){var n=Object(p.jsxs)("div",{className:"shared-type".concat(t.content.str?" insert":" delete").concat(t.id.client===e?" current":" link"),children:[Object(p.jsx)("p",{className:"clock",children:t.id.clock}),Object(p.jsx)("p",{className:"shared-type-value",children:t.content.str||t.content.len})]},function(t){return"".concat(t.id.client," ").concat(t.id.clock)}(t));return t.right?[n].concat(Object(i.a)(T(t.right,e))):[n]}function I(t){var e=[];return t.yDoc.store.clients.forEach((function(t,n){e.push(Object(p.jsxs)("div",{className:"client",children:[Object(p.jsxs)("p",{className:"client-id",children:["clientID: ",n]}),Object(p.jsx)("div",{className:"client-model",children:T(t[0].parent._start,n)})]},n))})),Object(p.jsxs)("div",{className:"y-doc-model",children:[t.yDoc.store.pendingStructs&&Object(p.jsxs)("div",{className:"pending-structs",children:[Object(p.jsx)("p",{children:"missing:"}),k(t.yDoc.store.pendingStructs.missing)]}),Object(p.jsx)("div",{className:"clients",children:e})]})}n(41);function R(t){return Object(p.jsxs)("div",{className:"doc-container",children:[Object(p.jsx)(g,{doc:t.doc,onCloseDoc:t.onCloseDoc}),Object(p.jsx)(C,{doc:t.doc,onEditorChange:t.onEditorChange,editable:t.editable}),Object(p.jsx)(E,{doc:t.doc,docs:t.docs,onSync:t.onSync,editable:t.editable}),Object(p.jsx)(I,{yDoc:t.doc.yDoc})]})}var M={DocEdit:[[f],[h,{id:0,actions:[{type:x,pos:0,str:"FOO"}]}],[h,{id:0,actions:[{type:m,pos:1,len:1}]}],[h,{id:0,actions:[{type:x,pos:1,str:"T"}]}],[h,{id:0,actions:[{type:x,pos:1,str:"B"}]}]],TwoDocsSyncWithoutConflicts:[[f],[f],[h,{id:0,actions:[{type:x,pos:0,str:"FOO"}]}],[b,{from:0,to:1}],[h,{id:1,actions:[{type:m,pos:1,len:1}]}],[h,{id:1,actions:[{type:x,pos:1,str:"T"}]}],[b,{from:1,to:0}]],TwoDocsSyncWithConflicts:[[f],[f],[h,{id:0,actions:[{type:x,pos:0,str:"FOO"}]}],[b,{from:0,to:1}],[h,{id:0,actions:[{type:x,pos:3,str:"B"}]}],[h,{id:1,actions:[{type:x,pos:3,str:"T"}]}],[b,{from:1,to:0}],[b,{from:0,to:1}]],TwoDocsSyncWithLostUpdates:[[f],[f],[h,{id:0,actions:[{type:x,pos:0,str:"FOO"}]}],[b,{from:0,to:1}],[h,{id:0,actions:[{type:x,pos:3,str:"B"}]}],[h,{id:0,actions:[{type:x,pos:4,str:"AR"}]}],[h,{id:1,actions:[{type:x,pos:3,str:"T"}]}],[b,{from:0,to:1,index:1}],[b,{from:1,to:0}],[b,{from:0,to:1,index:0}]]};n(42);function F(){var t,e=Object(c.useState)((t="scenario",new URL(window.location.href).searchParams.get(t)||u)),n=Object(d.a)(e,2),o=n[0],r=n[1],s=Object(c.useState)(0),j=Object(d.a)(s,2),y=j[0],g=j[1],S=Object(c.useState)([]),N=Object(d.a)(S,2),C=N[0],w=N[1];function E(t){w(t),window.docs=t}function k(t,e){E([].concat(Object(i.a)(C.slice(0,t)),[e(C[t])],Object(i.a)(C.slice(t+1))))}function T(){var t=new l.a,e=C.length;0!==e&&l.b(t,l.c(C[0].yDoc)),E([].concat(Object(i.a)(C),[{id:e,yDoc:t,updates:[]}]))}function I(t){t.yDoc.destroy(),k(t.id,(function(){return null}))}function F(t){var e=t.id,n=t.actions;k(e,(function(t){var e=n.map((function(e){var n=e.type,c=e.pos,o=e.str,r=e.len,s=l.d(t.yDoc),a=t.yDoc.getText(D);switch(n){case x:a.insert(c,o);break;case m:a.delete(c,r);break;default:throw new Error("Unexpected type")}return{action:e,payload:l.c(t.yDoc,s)}}));return 1===C.length?t:Object(a.a)(Object(a.a)({},t),{},{updates:[].concat(Object(i.a)(t.updates),Object(i.a)(e))})}))}function U(t){var e=t.from,n=t.to,c=t.index;k(e,(function(t){if(t){var e=C[n],o=void 0===c?t.updates:[t.updates[c]];return o.forEach((function(t){l.b(e.yDoc,t.payload)})),Object(a.a)(Object(a.a)({},t),{},{updates:t.updates.filter((function(t){return!o.includes(t)}))})}}))}var A=o===u;return Object(p.jsxs)("div",{className:"App",children:[Object(p.jsx)(v,{scenarios:M,currentScenario:o,currentScenarioStepIndex:y,onScenarioChange:function(t){r(t),g(0),E([])},onNextStep:function(){g(y+1);var t=M[o],e=Object(d.a)(t[y],2),n=e[0],c=e[1];switch(n){case f:T();break;case h:F(c);break;case b:U(c);break;case O:I(c);break;default:throw new Error("Unexpected action: "+n)}},onRestartStep:function(){g(0),E([])},onOpenDoc:T}),Object(p.jsx)("div",{className:"docs-container",children:C.filter(Boolean).map((function(t){return Object(p.jsx)(R,{doc:t,docs:C,editable:A,onCloseDoc:I,onEditorChange:F,onSync:U},t.id)}))})]})}s.a.render(Object(p.jsx)(o.a.StrictMode,{children:Object(p.jsx)(F,{})}),document.getElementById("root"))}},[[50,1,2]]]);
//# sourceMappingURL=main.00025e14.chunk.js.map