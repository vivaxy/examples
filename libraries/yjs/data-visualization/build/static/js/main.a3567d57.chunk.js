(this["webpackJsonpdata-visualization"]=this["webpackJsonpdata-visualization"]||[]).push([[0],{46:function(t,e,n){},47:function(t,e,n){},49:function(t,e,n){},50:function(t,e,n){},51:function(t,e,n){},52:function(t,e,n){},53:function(t,e,n){},54:function(t,e,n){},55:function(t,e,n){},63:function(t,e,n){"use strict";n.r(e);var c=n(21),o=n.n(c),r=n(40),s=n.n(r),a=(n(46),n(22)),i=n(16),d=n(11),l=n(28),u=(n(1),n(4),n(65),n(66),"CUSTOM_SCENARIO"),p=(n(47),n(8));function j(t){return Object(p.jsxs)("div",{className:"actions",children:[Object(p.jsx)("span",{children:"Actions: "}),Object(p.jsx)("button",{onClick:t.onOpenDoc,children:"Open a new doc"})]})}var f="DOC_OPEN",b="DOC_UPDATE",h="DOC_SYNC",O="DOC_CLOSE",x="INSERT",m="DELETE";n(49);function y(t){var e=Object(d.a)(t,2),n=e[0],c=e[1];switch(n){case f:return n;case b:if(c.type===x)return"".concat(n," Doc:").concat(c.id," type:").concat(c.type," pos:").concat(c.pos," str:").concat(c.str);if(c.type===m)return"".concat(n," Doc:").concat(c.id," type:").concat(c.type," pos:").concat(c.pos," len:").concat(c.len);throw new Error("Unexpect edit type: "+c.type);case h:return void 0===c.index?"".concat(n," FromDoc:").concat(c.from," ToDoc:").concat(c.to):"".concat(n," FromDoc:").concat(c.from," ToDoc:").concat(c.to," updateIndex:").concat(c.index);case O:return n;default:throw new Error("Expected action: "+n)}}function v(t){var e="scenarios";var n=t.scenarios[t.currentScenario],c=n&&n[t.currentScenarioStepIndex-1],o=n&&n[t.currentScenarioStepIndex];return Object(p.jsxs)("div",{className:"scenarios",children:[Object(p.jsx)("label",{htmlFor:e,children:"Scenarios: "}),Object(p.jsxs)("select",{id:e,onChange:function(e){e.target.value!==t.currentScenario&&t.onScenarioChange(e.target.value)},children:[Object(p.jsx)("option",{value:u,children:"Custom"}),Object.keys(t.scenarios).map((function(t){return Object(p.jsx)("option",{value:t,children:t},t)}))]}),n&&Object(p.jsx)("button",{disabled:t.currentScenario===u,onClick:function(){var e=t.scenarios[t.currentScenario];t.currentScenarioStepIndex<e.length?t.onNextStep():t.onRestartStep()},className:"next-step-button",children:o?"Next step":"Restart"}),o&&Object(p.jsx)("span",{className:"next-step",children:y(o)}),c&&Object(p.jsxs)("p",{className:"current-step",children:[Object(p.jsx)("span",{className:"current-step-label",children:"Current step: "}),Object(p.jsx)("span",{children:y(c)})]}),!n&&Object(p.jsx)(j,{onOpenDoc:function(){t.onOpenDoc()}})]})}n(50);function D(t){return Object(p.jsxs)("div",{className:"doc-tab",children:[Object(p.jsxs)("p",{className:"doc-id",children:["Doc",t.doc.id]}),Object(p.jsx)("button",{className:"doc-close",onClick:function(){t.onCloseDoc(t.doc)},children:"x"})]})}var S="sample-key";n(51);function g(t,e,n){var c=function(t,e,n){for(var c=Math.min(Math.max(t.length-1,0),Math.max(e.length-1,0),n),o=0;o<=c;o++)if(t[o]!==e[o])return o;return 0===t.length||0===e.length?0:c+1}(t,e,n),o=function(t,e,n){for(var c=Math.min(Math.max(t.length-1,0),Math.max(e.length-n,0)),o=0;o<=c;o++)if(t[t.length-1-o]!==e[e.length-1-o])return o;return c}(t,e,n),r={pos:c,len:t.length-o-c},s={pos:c,str:e.slice(c,e.length-o)},a=[];return r.len&&a.push({type:m,pos:r.pos,len:r.len}),s.str.length&&a.push({type:x,pos:s.pos,str:s.str}),a}function N(t){return t.getText(S).toString()}function C(t){var e=Object(c.useRef)(null),n=Object(c.useRef)(N(t.doc.yDoc));return Object(c.useEffect)((function(){var c=N(t.doc.yDoc);e.current.textContent!==c&&(e.current.textContent=c),n.current!==c&&(n.current=c)})),Object(p.jsx)("p",{contentEditable:t.editable?"true":"false",className:"editor",onInput:function(e){var c=e.target.textContent;if(n.current!==c){var o=window.getSelection().getRangeAt(0).startOffset,r=g(n.current,c,o);n.current=c,t.onEditorChange({id:t.doc.id,actions:r})}},ref:e})}n(52);function w(t){return"".concat(t.type," ").concat(t.pos," ").concat(t.str||t.len)}function E(t){function e(e,n){return function(){t.onSync({from:t.doc.id,to:e,index:n})}}return Object(p.jsx)("div",{className:"updates",children:t.doc.updates.map((function(n,c){return Object(p.jsxs)("p",{className:"update",children:[Object(p.jsx)("span",{className:"update-detail".concat(n.action.type===x?" insert":" delete"),children:w(n.action)}),t.editable&&t.docs.filter((function(e){return e&&e.id!==t.doc.id})).map((function(t){return Object(p.jsxs)("button",{className:"sync-button",onClick:e(t.id,c),children:["To Doc",t.id]},t.id)}))]},c+w(n.action))}))})}n(53);function k(t){var e=[];return t.forEach((function(t,n){e.push(Object(p.jsxs)("p",{children:[Object(p.jsxs)("span",{className:"client-id",children:[n,":"]}),Object(p.jsx)("span",{children:t})]},n))})),e}function T(t,e){var n=Object(p.jsxs)("div",{className:"shared-type".concat(t.content.str?" insert":" delete").concat(t.id.client===e?" current":" link"),children:[Object(p.jsx)("p",{className:"clock",children:t.id.clock}),Object(p.jsx)("p",{className:"shared-type-value",children:t.content.str||t.content.len})]},function(t){return"".concat(t.id.client," ").concat(t.id.clock)}(t));return t.right?[n].concat(Object(i.a)(T(t.right,e))):[n]}function I(t){var e=[];return t.yDoc.store.clients.forEach((function(t,n){e.push(Object(p.jsxs)("div",{className:"client",children:[Object(p.jsxs)("p",{className:"client-id",children:["clientID: ",n]}),Object(p.jsx)("div",{className:"client-model",children:T(t[0].parent._start,n)})]},n))})),Object(p.jsxs)("div",{className:"y-doc-model",children:[t.yDoc.store.pendingStructs&&Object(p.jsxs)("div",{className:"pending-structs",children:[Object(p.jsx)("p",{children:"missing:"}),k(t.yDoc.store.pendingStructs.missing)]}),Object(p.jsx)("div",{className:"clients",children:e})]})}n(54);function R(t){return Object(p.jsxs)("div",{className:"doc-container",children:[Object(p.jsx)(D,{doc:t.doc,onCloseDoc:t.onCloseDoc}),Object(p.jsx)(C,{doc:t.doc,onEditorChange:t.onEditorChange,editable:t.editable}),Object(p.jsx)(E,{doc:t.doc,docs:t.docs,onSync:t.onSync,editable:t.editable}),Object(p.jsx)(I,{yDoc:t.doc.yDoc})]})}var M={DocEdit:[[f],[b,{id:0,type:x,pos:0,str:"FOO"}],[b,{id:0,type:m,pos:1,len:1}],[b,{id:0,type:x,pos:1,str:"T"}],[b,{id:0,type:x,pos:1,str:"B"}]],TwoDocsSyncWithoutConflicts:[[f],[f],[b,{id:0,type:x,pos:0,str:"FOO"}],[h,{from:0,to:1}],[b,{id:1,type:m,pos:1,len:1}],[b,{id:1,type:x,pos:1,str:"T"}],[h,{from:1,to:0}]],TwoDocsSyncWithConflicts:[[f],[f],[b,{id:0,type:x,pos:0,str:"FOO"}],[h,{from:0,to:1}],[b,{id:0,type:x,pos:3,str:"B"}],[b,{id:1,type:x,pos:3,str:"T"}],[h,{from:1,to:0}],[h,{from:0,to:1}]],TwoDocsSyncWithLostUpdates:[[f],[f],[b,{id:0,type:x,pos:0,str:"FOO"}],[h,{from:0,to:1}],[b,{id:0,type:x,pos:3,str:"B"}],[b,{id:0,type:x,pos:4,str:"AR"}],[b,{id:1,type:x,pos:3,str:"T"}],[h,{from:0,to:1,index:1}],[h,{from:1,to:0}],[h,{from:0,to:1,index:0}]]};n(55);function F(){var t,e=Object(c.useState)((t="scenario",new URL(window.location.href).searchParams.get(t)||u)),n=Object(d.a)(e,2),o=n[0],r=n[1],s=Object(c.useState)(0),j=Object(d.a)(s,2),y=j[0],D=j[1],g=Object(c.useState)([]),N=Object(d.a)(g,2),C=N[0],w=N[1];function E(t){w(t),window.docs=t}function k(t,e){E([].concat(Object(i.a)(C.slice(0,t)),[e(C[t])],Object(i.a)(C.slice(t+1))))}function T(){var t=new l.a,e=C.length;0!==e&&l.b(t,l.c(C[0].yDoc)),E([].concat(Object(i.a)(C),[{id:e,yDoc:t,updates:[]}]))}function I(t){t.yDoc.destroy(),k(t.id,(function(){return null}))}function F(t){var e=t.id,n=t.actions;k(e,(function(t){var e=n.map((function(e){var n=e.type,c=e.pos,o=e.str,r=e.len,s=l.d(t.yDoc),a=t.yDoc.getText(S);switch(n){case x:a.insert(c,o);break;case m:a.delete(c,r);break;default:throw new Error("Unexpected type")}return{action:e,payload:l.c(t.yDoc,s)}}));return 1===C.length?t:Object(a.a)(Object(a.a)({},t),{},{updates:[].concat(Object(i.a)(t.updates),Object(i.a)(e))})}))}function U(t){var e=t.from,n=t.to,c=t.index;k(e,(function(t){if(t){var e=C[n],o=void 0===c?t.updates:[t.updates[c]];return o.forEach((function(t){l.b(e.yDoc,t.payload)})),Object(a.a)(Object(a.a)({},t),{},{updates:t.updates.filter((function(t){return!o.includes(t)}))})}}))}var A=o===u;return Object(p.jsxs)("div",{className:"App",children:[Object(p.jsx)(v,{scenarios:M,currentScenario:o,currentScenarioStepIndex:y,onScenarioChange:function(t){r(t),D(0),E([])},onNextStep:function(){D(y+1);var t=M[o],e=Object(d.a)(t[y],2),n=e[0],c=e[1];switch(n){case f:T();break;case b:F(c);break;case h:U(c);break;case O:I(c);break;default:throw new Error("Unexpected action: "+n)}},onRestartStep:function(){D(0),E([])},onOpenDoc:T}),Object(p.jsx)("div",{className:"docs-container",children:C.filter(Boolean).map((function(t){return Object(p.jsx)(R,{doc:t,docs:C,editable:A,onCloseDoc:I,onEditorChange:F,onSync:U},t.id)}))})]})}s.a.render(Object(p.jsx)(o.a.StrictMode,{children:Object(p.jsx)(F,{})}),document.getElementById("root"))}},[[63,1,2]]]);
//# sourceMappingURL=main.a3567d57.chunk.js.map