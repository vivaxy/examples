{"version":3,"sources":["components/Scenarios.js","components/Actions.js","components/Doc/YDocModel.js","enums/edit-types.js","enums/y-doc-keys.js","components/Doc.js","enums/event-types.js","scenarios/index.js","scenarios/doc-edit.js","scenarios/two-docs-sync-without-conflicts.js","scenarios/two-docs-sync-with-conflicts.js","scenarios/two-docs-sync-with-lost-updates.js","App.js","index.js"],"names":["Scenarios","props","SCENARIOS_ID","className","htmlFor","id","onChange","e","target","value","currentScenario","onScenarioChange","Object","keys","scenarios","map","scenario","disabled","hasNextStep","onClick","onNextStep","Actions","onOpenDoc","renderMissing","missing","res","forEach","clientID","push","renderModel","sharedType","sharedTypeNode","content","str","clock","len","client","getSharedTypeId","right","YDocModel","children","yDoc","store","clients","items","parent","_start","pendingStructs","INSERT","DELETE","TEXT_KEY","stringifyAction","action","type","pos","getTextFromYDoc","getText","Y_DOC_KEYS","toString","Doc","editorRef","useRef","editorValue","doc","createHandleSync","toDocId","update","onSync","fromDocId","useEffect","text","current","textContent","onCloseDoc","contentEditable","onInput","cursorPos","window","getSelection","getRangeAt","startOffset","change","prev","cur","length","EDIT_TYPES","slice","Error","getChanges","onEditorChange","ref","updates","index","docs","filter","DOC_OPEN","DOC_UPDATE","DOC_SYNC","docEdit","E","string","twoDocsSyncWithoutConflicts","from","to","twoDocsSyncWithConflicts","twoDocsSyncWithLostUpdates","App","useState","setCurrentScenario","currentScenarioStepIndex","setCurrentScenarioStepIndex","setDocs","updateDocById","updateDoc","newDocs","handleCloseDoc","destroy","handleEditorChange","prevStateVector","Y","yText","EDIT_TYPE","insert","delete","payload","handleSync","toDoc","_update","Boolean","ReactDOM","render","StrictMode","document","getElementById"],"mappings":"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","file":"static/js/main.e07b8752.chunk.js","sourcesContent":["/**\n * @since 2021-06-25\n * @author vivaxy\n */\nexport default function Scenarios(props) {\n  const SCENARIOS_ID = 'scenarios';\n\n  function handleChange(e) {\n    if (e.target.value !== props.currentScenario) {\n      props.onScenarioChange(e.target.value);\n    }\n  }\n\n  function handleClick() {\n    props.onNextStep();\n  }\n\n  return (\n    <div className=\"scenarios\">\n      <label htmlFor={SCENARIOS_ID}>Scenarios:</label>\n      <select id={SCENARIOS_ID} onChange={handleChange}>\n        {Object.keys(props.scenarios).map(function (scenario) {\n          return <option key={scenario} value={scenario}>{scenario}</option>;\n        })}\n      </select>\n      <button disabled={!props.hasNextStep} onClick={handleClick}>\n        Next step\n      </button>\n    </div>\n  );\n}\n","/**\n * @since 2021-06-25\n * @author vivaxy\n */\nexport default function Actions(props) {\n  return (\n    <div className=\"actions\">\n      <span>Actions:</span>\n      <button onClick={props.onOpenDoc}>Open a new doc</button>\n    </div>\n  );\n}\n","/**\n * @since 2021-06-25\n * @author vivaxy\n */\nimport './YDocModel.css';\n\nfunction getSharedTypeId(sharedType) {\n  return `${sharedType.id.client} ${sharedType.id.clock}`;\n}\n\nfunction renderMissing(missing) {\n  const res = [];\n  missing.forEach(function (value, clientID) {\n    res.push(\n      <p key={clientID}>\n        <span className=\"client-id\">{clientID}:</span>\n        <span>{value}</span>\n      </p>,\n    );\n  });\n  return res;\n}\n\nfunction renderModel(sharedType) {\n  const sharedTypeNode = (\n    <div\n      className={`shared-type${sharedType.content.str ? ' insert' : ' delete'}`}\n      key={getSharedTypeId(sharedType)}\n    >\n      <p className=\"clock\">{sharedType.id.clock}</p>\n      <p className=\"shared-type-value\">\n        {sharedType.content.str || sharedType.content.len}\n      </p>\n    </div>\n  );\n\n  if (sharedType.right) {\n    return [sharedTypeNode, ...renderModel(sharedType.right)];\n  }\n  return [sharedTypeNode];\n}\n\nexport default function YDocModel(props) {\n  const children = [];\n  props.yDoc.store.clients.forEach(function (items, clientID) {\n    children.push(\n      <div className=\"client\" key={clientID}>\n        <p className=\"client-id\">clientID: {clientID}</p>\n        <div className=\"client-model\">\n          {renderModel(items[0].parent._start)}\n        </div>\n      </div>,\n    );\n  });\n\n  return (\n    <div className=\"y-doc-model\">\n      {props.yDoc.store.pendingStructs && (\n        <div className=\"pending-structs\">\n          <p>missing:</p>\n          {renderMissing(props.yDoc.store.pendingStructs.missing)}\n        </div>\n      )}\n      <div className=\"clients\">{children}</div>\n    </div>\n  );\n}\n","/**\n * @since 2021-06-24\n * @author vivaxy\n */\nexport const INSERT = 'INSERT';\nexport const DELETE = 'DELETE';\n","/**\n * @since 2021-06-25\n * @author vivaxy\n */\nexport const TEXT_KEY = 'sample-key';\n","/**\n * @since 2021-06-25\n * @author vivaxy\n */\nimport { useRef, useEffect } from 'react';\nimport YDocModel from './Doc/YDocModel';\nimport './Doc.css';\nimport * as EDIT_TYPES from '../enums/edit-types';\nimport * as Y_DOC_KEYS from '../enums/y-doc-keys';\n\nfunction getChanges(prev, cur, cursorPos) {\n  if (cur.length > prev.length) {\n    return {\n      type: EDIT_TYPES.INSERT,\n      pos: cursorPos - cur.length + prev.length,\n      str: cur.slice(cursorPos - cur.length + prev.length, cursorPos),\n    };\n  }\n  if (cur.length < prev.length) {\n    return {\n      type: EDIT_TYPES.DELETE,\n      pos: cursorPos,\n      len: prev.length - cur.length,\n    };\n  }\n  throw new Error('Unexpected change');\n}\n\nfunction stringifyAction(action) {\n  return `${action.type} ${action.pos} ${action.str || action.len}`;\n}\n\nfunction getTextFromYDoc(yDoc) {\n  return yDoc.getText(Y_DOC_KEYS.TEXT_KEY).toString();\n}\n\nexport default function Doc(props) {\n  const editorRef = useRef(null);\n  const editorValue = useRef(getTextFromYDoc(props.doc.yDoc));\n\n  function handleCloseDoc() {\n    props.onCloseDoc(props.doc);\n  }\n\n  function handleInput(e) {\n    const value = e.target.textContent;\n    if (editorValue.current !== value) {\n      const cursorPos = window.getSelection().getRangeAt(0).startOffset;\n      const change = getChanges(editorValue.current, value, cursorPos);\n      editorValue.current = value;\n      props.onEditorChange({\n        id: props.doc.id,\n        ...change,\n      });\n    }\n  }\n\n  function createHandleSync(toDocId, update) {\n    return function handleSync() {\n      props.onSync({ fromDocId: props.doc.id, toDocId, update });\n    };\n  }\n\n  useEffect(function () {\n    const text = getTextFromYDoc(props.doc.yDoc);\n    if (editorRef.current.textContent !== text) {\n      editorRef.current.textContent = text;\n    }\n    if (editorValue.current !== text) {\n      editorValue.current = text;\n    }\n  });\n\n  return (\n    <div className=\"doc-container\">\n      <div className=\"doc-tab\">\n        <p className=\"doc-id\">Doc{props.doc.id}</p>\n        <button className=\"doc-close\" onClick={handleCloseDoc}>\n          x\n        </button>\n      </div>\n      <p\n        contentEditable=\"true\"\n        className=\"editor\"\n        onInput={handleInput}\n        ref={editorRef}\n      />\n      <div className=\"updates\">\n        {props.doc.updates.map(function (update, index) {\n          return (\n            <p className=\"update\" key={index + stringifyAction(update.action)}>\n              <span\n                className={`update-detail${\n                  update.action.type === EDIT_TYPES.INSERT\n                    ? ' insert'\n                    : ' delete'\n                }`}\n              >\n                {stringifyAction(update.action)}\n              </span>\n              {props.docs\n                .filter(function (doc) {\n                  return doc.id !== props.doc.id;\n                })\n                .map(function (doc) {\n                  return (\n                    <button\n                      className=\"sync-button\"\n                      key={doc.id}\n                      onClick={createHandleSync(doc.id, update)}\n                    >\n                      To Doc{doc.id}\n                    </button>\n                  );\n                })}\n            </p>\n          );\n        })}\n      </div>\n      <YDocModel yDoc={props.doc.yDoc} />\n    </div>\n  );\n}\n","/**\n * @since 2021-06-24\n * @author vivaxy\n */\nexport const DOC_OPEN = 'DOC_OPEN';\nexport const DOC_UPDATE = 'DOC_UPDATE';\nexport const DOC_SYNC = 'DOC_SYNC';\nexport const DOC_CLOSE = 'DOC_CLOSE';\n","/**\n * @since 2021-06-25\n * @author vivaxy\n */\nimport docEdit from './doc-edit';\nimport twoDocsSyncWithoutConflicts from './two-docs-sync-without-conflicts.js';\nimport twoDocsSyncWithConflicts from './two-docs-sync-with-conflicts.js';\nimport twoDocsSyncWithLostUpdates from './two-docs-sync-with-lost-updates.js';\n\nexport default {\n  docEdit,\n  twoDocsSyncWithoutConflicts,\n  twoDocsSyncWithConflicts,\n  twoDocsSyncWithLostUpdates,\n};\n","/**\n * @since 2021-06-25\n * @author vivaxy\n */\nimport * as E from '../enums/event-types.js';\nimport * as EDIT_TYPES from '../enums/edit-types.js';\n\nexport default [\n  [E.DOC_OPEN],\n  [\n    E.DOC_UPDATE,\n    {\n      id: 0,\n      type: EDIT_TYPES.INSERT,\n      pos: 0,\n      string: 'FOO',\n    },\n  ],\n  [\n    E.DOC_UPDATE,\n    {\n      id: 0,\n      type: EDIT_TYPES.DELETE,\n      pos: 1,\n      length: 1,\n    },\n  ],\n  [\n    E.DOC_UPDATE,\n    {\n      id: 0,\n      type: EDIT_TYPES.INSERT,\n      pos: 1,\n      string: 'T',\n    },\n  ],\n  [\n    E.DOC_UPDATE,\n    {\n      id: 0,\n      type: EDIT_TYPES.INSERT,\n      pos: 1,\n      string: 'B',\n    },\n  ],\n];\n","/**\n * @since 2021-06-25\n * @author vivaxy\n */\nimport * as E from '../enums/event-types.js';\nimport * as EDIT_TYPES from '../enums/edit-types.js';\n\nexport default [\n  [E.DOC_OPEN],\n  [E.DOC_OPEN],\n  [\n    E.DOC_UPDATE,\n    {\n      id: 0,\n      type: EDIT_TYPES.INSERT,\n      pos: 0,\n      string: 'FOO',\n    },\n  ],\n  [\n    E.DOC_SYNC,\n    {\n      from: 0,\n      to: 1,\n    },\n  ],\n  [\n    E.DOC_UPDATE,\n    {\n      id: 1,\n      type: EDIT_TYPES.DELETE,\n      pos: 1,\n      length: 1,\n    },\n  ],\n  [\n    E.DOC_UPDATE,\n    {\n      id: 1,\n      type: EDIT_TYPES.INSERT,\n      pos: 1,\n      string: 'T',\n    },\n  ],\n  [\n    E.DOC_SYNC,\n    {\n      from: 1,\n      to: 0,\n    },\n  ],\n];\n","/**\n * @since 2021-06-25\n * @author vivaxy\n */\nimport * as E from '../enums/event-types.js';\nimport * as EDIT_TYPES from '../enums/edit-types.js';\n\nexport default [\n  [E.DOC_OPEN],\n  [E.DOC_OPEN],\n  [\n    E.DOC_UPDATE,\n    {\n      id: 0,\n      type: EDIT_TYPES.INSERT,\n      pos: 0,\n      string: 'FOO',\n    },\n  ],\n  [\n    E.DOC_SYNC,\n    {\n      from: 0,\n      to: 1,\n    },\n  ],\n  [\n    E.DOC_UPDATE,\n    {\n      id: 0,\n      type: EDIT_TYPES.INSERT,\n      pos: 3,\n      string: 'B',\n    },\n  ],\n  [\n    E.DOC_UPDATE,\n    {\n      id: 1,\n      type: EDIT_TYPES.INSERT,\n      pos: 3,\n      string: 'T',\n    },\n  ],\n  [\n    E.DOC_SYNC,\n    {\n      from: 1,\n      to: 0,\n    },\n  ],\n  [\n    E.DOC_SYNC,\n    {\n      from: 0,\n      to: 1,\n    },\n  ],\n];\n","/**\n * @since 2021-06-25\n * @author vivaxy\n */\nimport * as E from '../enums/event-types.js';\nimport * as EDIT_TYPES from '../enums/edit-types.js';\n\nexport default [\n  [E.DOC_OPEN],\n  [E.DOC_OPEN],\n  [\n    E.DOC_UPDATE,\n    {\n      id: 0,\n      type: EDIT_TYPES.INSERT,\n      pos: 0,\n      string: 'FOO',\n    },\n  ],\n  [\n    E.DOC_SYNC,\n    {\n      from: 0,\n      to: 1,\n    },\n  ],\n  [\n    E.DOC_SYNC,\n    {\n      id: 0,\n      type: EDIT_TYPES.INSERT,\n      pos: 3,\n      string: 'B',\n    },\n  ],\n  [\n    E.DOC_SYNC,\n    {\n      id: 1,\n      type: EDIT_TYPES.INSERT,\n      pos: 3,\n      string: 'T',\n    },\n  ],\n  [\n    E.DOC_SYNC,\n    {\n      from: 1,\n      to: 0,\n    },\n  ],\n  [\n    E.DOC_SYNC,\n    {\n      from: 0,\n      to: 1,\n    },\n  ],\n];\n","import { useState } from 'react';\nimport * as Y from 'yjs';\n\nimport Scenarios from './components/Scenarios';\nimport Actions from './components/Actions';\nimport Doc from './components/Doc';\nimport scenarios from './scenarios';\nimport * as EDIT_TYPE from './enums/edit-types';\nimport * as Y_DOC_KEYS from './enums/y-doc-keys';\n\nimport './App.css';\n\nexport default function App() {\n  const [currentScenario, setCurrentScenario] = useState(\n    Object.keys(scenarios)[0],\n  );\n  const [currentScenarioStepIndex, setCurrentScenarioStepIndex] = useState(0);\n  const [docs, setDocs] = useState([]);\n\n  function updateDocById(id, updateDoc) {\n    const newDocs = [\n      ...docs.slice(0, id),\n      updateDoc(docs[id]),\n      ...docs.slice(id + 1),\n    ];\n    setDocs(newDocs);\n  }\n\n  function handleScenarioChange(scenario) {\n    setCurrentScenario(scenario);\n    setCurrentScenarioStepIndex(0);\n  }\n\n  function handleNextStep() {\n    const currentScenarioSteps = scenarios[currentScenario];\n    if (currentScenarioStepIndex < currentScenarioSteps.length) {\n      setCurrentScenarioStepIndex(currentScenarioStepIndex + 1);\n    } else {\n      setCurrentScenarioStepIndex(0);\n    }\n  }\n\n  function handleOpenDoc() {\n    const yDoc = new Y.Doc();\n    setDocs([\n      ...docs,\n      {\n        id: docs.length,\n        yDoc: yDoc, // mutable\n        updates: [], // { action, payload }\n      },\n    ]);\n  }\n\n  function handleCloseDoc(doc) {\n    doc.yDoc.destroy();\n    updateDocById(doc.id, function () {\n      return null;\n    });\n  }\n\n  function handleEditorChange(action) {\n    const { id, type, pos, str, len } = action;\n    updateDocById(id, function (doc) {\n      const prevStateVector = Y.encodeStateVector(doc.yDoc);\n      const yText = doc.yDoc.getText(Y_DOC_KEYS.TEXT_KEY);\n      switch (type) {\n        case EDIT_TYPE.INSERT:\n          yText.insert(pos, str);\n          break;\n        case EDIT_TYPE.DELETE:\n          yText.delete(pos, len);\n          break;\n        default:\n          throw new Error('Unexpected type');\n      }\n\n      const update = Y.encodeStateAsUpdate(doc.yDoc, prevStateVector);\n\n      return {\n        ...doc,\n        updates: [\n          ...doc.updates,\n          {\n            action,\n            payload: update,\n          },\n        ],\n      };\n    });\n  }\n\n  function handleSync({ fromDocId, toDocId, update }) {\n    updateDocById(fromDocId, function (doc) {\n      const toDoc = docs[toDocId];\n      Y.applyUpdate(toDoc.yDoc, update.payload);\n      return {\n        ...doc,\n        updates: doc.updates.filter(function (_update) {\n          return _update !== update;\n        }),\n      };\n    });\n  }\n\n  const currentScenarioSteps = scenarios[currentScenario];\n  const hasNextStep = currentScenarioStepIndex < currentScenarioSteps.length;\n\n  return (\n    <div className=\"App\">\n      <Scenarios\n        scenarios={scenarios}\n        currentScenario={currentScenario}\n        onScenarioChange={handleScenarioChange}\n        hasNextStep={hasNextStep}\n        onNextStep={handleNextStep}\n      />\n      <Actions onOpenDoc={handleOpenDoc} />\n      <div className=\"docs-container\">\n        {docs.filter(Boolean).map(function (doc) {\n          return (\n            <Doc\n              key={doc.id}\n              doc={doc}\n              docs={docs}\n              onCloseDoc={handleCloseDoc}\n              onEditorChange={handleEditorChange}\n              onSync={handleSync}\n            />\n          );\n        })}\n      </div>\n    </div>\n  );\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n"],"sourceRoot":""}