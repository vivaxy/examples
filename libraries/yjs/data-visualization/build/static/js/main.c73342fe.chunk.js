(this["webpackJsonpdata-visualization"]=this["webpackJsonpdata-visualization"]||[]).push([[0],{35:function(t,e,n){},37:function(t,e,n){},39:function(t,e,n){},40:function(t,e,n){},41:function(t,e,n){},42:function(t,e,n){},49:function(t,e,n){},50:function(t,e,n){},51:function(t,e,n){},52:function(t,e,n){"use strict";n.r(e);var c=n(19),r=n.n(c),o=n(29),a=n.n(o),s=(n(35),n(16)),i=n.n(s),u=n(13),l=n(14),d=n(20),p=n(12),f=n(18),h="CUSTOM_SCENARIO",j="DOC_OPEN",b="DOC_UPDATE",O="DOC_SYNC",x="DOC_CLOSE",g="INSERT",y="DELETE",m=(n(37),n(3));function v(t){var e=Object(p.a)(t,2),n=e[0],c=e[1];switch(n){case j:return n;case b:var r=c.id;return c.actions.map((function(t){if(t.type===g)return"".concat(n," Doc:").concat(r," type:").concat(t.type," pos:").concat(t.pos," str:").concat(t.str);if(t.type===y)return"".concat(n," Doc:").concat(r," type:").concat(t.type," pos:").concat(t.pos," len:").concat(t.len);throw new Error("Unexpect edit type: "+t.type)})).join(" ; ");case O:return void 0===c.index?"".concat(n," FromDoc:").concat(c.from," ToDoc:").concat(c.to):"".concat(n," FromDoc:").concat(c.from," ToDoc:").concat(c.to," updateIndex:").concat(c.index);case x:return n;default:throw new Error("Expected action: "+n)}}function k(t){var e="scenarios";var n=t.scenarios[t.currentScenario],c=n&&n[t.currentScenarioStepIndex-1],r=n&&n[t.currentScenarioStepIndex];return Object(m.jsxs)("div",{className:"scenarios",children:[Object(m.jsx)("label",{htmlFor:e,children:"Scenarios: "}),Object(m.jsxs)("select",{id:e,onChange:function(e){e.target.value!==t.currentScenario&&t.onScenarioChange(e.target.value)},children:[Object(m.jsx)("option",{value:h,children:"Custom"}),Object.keys(t.scenarios).map((function(t){return Object(m.jsx)("option",{value:t,children:t},t)}))]}),n&&Object(m.jsx)("button",{disabled:t.currentScenario===h,onClick:function(){var e=t.scenarios[t.currentScenario];t.currentScenarioStepIndex<e.length?t.onNextStep():t.onRestartStep()},className:"next-step-button",children:r?"Next step":"Restart"}),r&&Object(m.jsx)("span",{className:"next-step",children:v(r)}),c&&Object(m.jsxs)("p",{className:"current-step",children:[Object(m.jsx)("span",{className:"current-step-label",children:"Current step: "}),Object(m.jsx)("span",{children:v(c)})]})]})}n(39);function D(t){return Object(m.jsxs)("div",{className:"doc-tab",children:[Object(m.jsxs)("p",{className:"doc-id",children:["Doc",t.doc.id]}),Object(m.jsxs)("span",{className:"doc-options",children:[Object(m.jsxs)("span",{children:["GC: ",t.doc.yDoc.gc?"\u2705":"\u274c"]}),Object(m.jsxs)("span",{children:["PermanentUserData: ",t.doc.pud?"\u2705":"\u274c"]})]}),t.editable&&Object(m.jsx)("button",{className:"doc-close",onClick:function(){t.onCloseDoc(t.doc)},children:"x"})]})}var w="sample-key";n(40);function S(t,e,n){var c=function(t,e,n){for(var c=Math.min(Math.max(t.length-1,0),Math.max(e.length-1,0),n),r=0;r<=c;r++)if(t[r]!==e[r])return r;return 0===t.length||0===e.length?0:c+1}(t,e,n),r=function(t,e,n){for(var c=Math.min(Math.max(t.length-1,0),Math.max(e.length-n,0)),r=0;r<=c;r++)if(t[t.length-1-r]!==e[e.length-1-r])return r;return c}(t,e,n);if(c+r>t.length-1||c+r>e.length-1){var o=function(t,e,n){if(t.length>e.length)return{type:y,pos:n,len:t.length-e.length};if(t.length<e.length){var c=n-(e.length-t.length);return{type:g,pos:c,str:e.slice(c,n)}}return null}(t,e,n);return o?[o]:[]}var a={pos:c,len:t.length-r-c},s={pos:c,str:e.slice(c,e.length-r)},i=[];return a.len&&i.push({type:y,pos:a.pos,len:a.len}),s.str.length&&i.push({type:g,pos:s.pos,str:s.str}),i}function N(t){return t.getText(w).toString()}function C(t){var e=Object(c.useRef)(null),n=Object(c.useRef)(N(t.doc.yDoc));return Object(c.useEffect)((function(){var c=N(t.doc.yDoc);e.current.textContent!==c&&(e.current.textContent=c),n.current!==c&&(n.current=c)})),Object(m.jsx)("p",{contentEditable:t.editable?"true":"false",className:"editor",onInput:function(e){var c=e.target.textContent;if(n.current!==c){var r=window.getSelection().getRangeAt(0).startOffset,o=S(n.current,c,r);o.length&&(n.current=c,t.onEditorChange({id:t.doc.id,actions:o}))}},ref:e})}n(41);function E(t){return"".concat(t.type," ").concat(t.pos," ").concat(t.str||t.len)}function I(t){function e(e,n){return function(){t.onSync({from:t.doc.id,to:e,index:n})}}return Object(m.jsx)("div",{className:"updates",children:t.doc.updates.map((function(n,c){return Object(m.jsxs)("p",{className:"update",children:[Object(m.jsx)("span",{className:"update-detail".concat(n.action.type===g?" insert":" delete"),children:E(n.action)}),t.editable&&t.docs.filter((function(t){return t&&!n.syncedIds.includes(t.id)})).map((function(t){return Object(m.jsxs)("button",{className:"sync-button",onClick:e(t.id,c),children:["To Doc",t.id]},t.id)}))]},c+E(n.action))}))})}n(42);function T(t){var e=[];return t.forEach((function(t,n){e.push(Object(m.jsxs)("p",{children:[Object(m.jsxs)("span",{className:"client-id",children:[n,":"]}),Object(m.jsx)("span",{children:t})]},n))})),e}function R(t,e){if(!t)return[];var n,c=function(t){var e={client:t.id.client,clock:t.id.clock};return t.content instanceof f.b?Object(l.a)(Object(l.a)({},e),{},{deleted:!0,len:t.content.len}):t.deleted?Object(l.a)(Object(l.a)({},e),{},{deleted:!0,content:t.content.str,len:t.content.str.length}):Object(l.a)(Object(l.a)({},e),{},{deleted:!1,content:t.content.str})}(t);return[Object(m.jsxs)("div",{className:"item".concat(c.deleted?" delete":" insert").concat(c.client===e?" current":" link"),children:[Object(m.jsx)("p",{className:"clock",children:c.clock}),Object(m.jsx)("p",{className:"item-value",children:c.content||c.len})]},"".concat((n=t).id.client," ").concat(n.id.clock))].concat(Object(u.a)(R(t.right,e)))}function U(t,e){var n=[],c=new f.e(t);return c.dss.forEach((function(t,r){c.clients.get(e)===r&&t.clients.forEach((function(t,e){t.forEach((function(t){n.push(Object(m.jsxs)("div",{className:"item delete",children:[Object(m.jsx)("p",{className:"clock",children:t.clock}),Object(m.jsx)("p",{className:"item-value",children:t.len})]},"".concat(e,"-").concat(t.clock)))}))}))})),n}function F(t){var e=[];return t.yDoc.store.clients.forEach((function(n,c){e.push(Object(m.jsxs)("div",{className:"client",children:[Object(m.jsxs)("p",{className:"client-id",children:["clientID: ",c]}),Object(m.jsx)("p",{className:"label",children:"Text:"}),Object(m.jsx)("div",{className:"client-text",children:R(t.yDoc.getText(w)._start,c)}),Object(m.jsx)("p",{className:"label",children:"DeleteSet:"}),Object(m.jsx)("div",{className:"pud",children:U(t.yDoc,c)})]},c))})),Object(m.jsxs)("div",{className:"y-doc-model",children:[t.yDoc.store.pendingStructs&&Object(m.jsxs)("div",{className:"pending-structs",children:[Object(m.jsx)("p",{children:"missing:"}),T(t.yDoc.store.pendingStructs.missing)]}),Object(m.jsx)("div",{className:"clients",children:e})]})}n(49);function M(t){return Object(m.jsxs)("div",{className:"doc-container",children:[Object(m.jsx)(D,{doc:t.doc,onCloseDoc:t.onCloseDoc,editable:t.editable}),Object(m.jsx)(C,{doc:t.doc,onEditorChange:t.onEditorChange,editable:t.editable}),Object(m.jsx)(I,{doc:t.doc,docs:t.docs,onSync:t.onSync,editable:t.editable}),Object(m.jsx)(F,{yDoc:t.doc.yDoc})]})}function L(t){return Object(m.jsxs)("span",{className:"buttons-container",children:[Object(m.jsx)("span",{children:"Actions: "}),Object(m.jsx)("button",{onClick:function(){t.onOpenDoc()},children:"Open a new doc"})]})}var B=n(9),A=(n(50),"option-gc"),P="option-pud";function _(t){return t.target.value}function J(t){function e(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:_;return function(c){t.onOptionChange(Object(B.a)({},e,n(c)))}}return Object(m.jsxs)("span",{className:"options-container",children:[Object(m.jsx)("label",{htmlFor:A,children:"GC:"}),Object(m.jsx)("input",{id:A,type:"checkbox",checked:t.options.gc,onChange:e("gc",(function(t){return t.target.checked}))}),Object(m.jsx)("label",{htmlFor:P,children:"PermanentUserData:"}),Object(m.jsx)("input",{id:P,type:"checkbox",checked:t.options.pud,onChange:e("pud",(function(t){return t.target.checked}))})]})}function W(t){return Object(m.jsxs)("div",{className:"actions-container",children:[Object(m.jsx)(L,{onOpenDoc:t.onOpenDoc}),Object(m.jsx)(J,{options:t.options,onOptionChange:t.onOptionChange})]})}var z={DocEdit:[[j],[b,{id:0,actions:[{type:g,pos:0,str:"FOO"}]}],[b,{id:0,actions:[{type:y,pos:1,len:1}]}],[b,{id:0,actions:[{type:g,pos:1,str:"T"}]}],[b,{id:0,actions:[{type:g,pos:1,str:"B"}]}]],TwoDocsSyncWithoutConflicts:[[j],[j],[b,{id:0,actions:[{type:g,pos:0,str:"FOO"}]}],[O,{from:0,to:1}],[b,{id:1,actions:[{type:y,pos:1,len:1}]}],[b,{id:1,actions:[{type:g,pos:1,str:"T"}]}],[O,{from:1,to:0}]],TwoDocsSyncWithConflicts:[[j],[j],[b,{id:0,actions:[{type:g,pos:0,str:"FOO"}]}],[O,{from:0,to:1}],[b,{id:0,actions:[{type:g,pos:3,str:"B"}]}],[b,{id:1,actions:[{type:g,pos:3,str:"T"}]}],[O,{from:1,to:0}],[O,{from:0,to:1}]],TwoDocsSyncWithLostUpdates:[[j],[j],[b,{id:0,actions:[{type:g,pos:0,str:"FOO"}]}],[O,{from:0,to:1}],[b,{id:0,actions:[{type:g,pos:3,str:"B"}]}],[b,{id:0,actions:[{type:g,pos:4,str:"AR"}]}],[b,{id:1,actions:[{type:g,pos:3,str:"T"}]}],[O,{from:0,to:1,index:1}],[O,{from:1,to:0}],[O,{from:0,to:1,index:0}]]};function G(t){return new Promise((function(e){setTimeout(e,t)}))}var Y=n(2),K=n(0),q=n(4),H=n(11),Q=[function(){return new f.a},function(){return new f.d},function(){return new f.f},function(t){K.k(t)},function(t){},function(t){K.k(t)},function(t){}];var V=[function(){throw H.c()},function(t){return{type:"deleted",length:K.l(t)}},function(t){for(var e=K.l(t),n=[],c=0;c<e;c++){var r=K.k(t);"undefined"===r?n.push(void 0):n.push(JSON.parse(r))}return{type:"json",content:n,length:e}},function(t){return{type:"binary",content:K.m(t),length:1}},function(t){var e=K.k(t);return{type:"string",string:e,length:e.length}},function(t){return{type:"embed",content:K.k(t),length:1}},function(t){return{type:"format",content:{key:K.k(t),value:K.k(t)},length:1}},function(t){return{type:"type",content:Q[K.l(t)](t),length:1}},function(t){for(var e=K.l(t),n=[],c=0;c<e;c++){var r=K.h(t);n.push(r)}return{type:"any",content:n,length:e}}];function X(t){t instanceof K.a||(t=K.f(t));for(var e={clients:{}},n=K.l(t),c=0;c<n;c++){var r=K.l(t),o=K.l(t);if(o>0){e.clients[r]=[];for(var a=0;a<o;a++)e.clients[r].push({clock:K.l(t),length:K.l(t)})}}return e}function Z(t,e){e instanceof K.a||(e=K.f(e));var n=function(t){for(var e={},n=K.l(t),c=0,r=0;r<n;r++){for(var o=K.l(t),a=[],s=$(t),i=s.clock,u=s.client,l=0;l<o;l++){var d=K.i(t),p=void 0;p=0!==(q.i&d)?et(u,i,t,d):new tt(u,i,{length:K.l(t)}),a.push(p),i+=p.length,c+=p.length}e[u]={items:a,totalLength:c}}return e}(e)[t],c=X(e);if(!n)return Object.keys(c.clients).length?{clientID:t,deleteSet:c}:{clientID:t};var r=n.items[0].clock,o=n.totalLength;return Object.keys(c.clients).length?{clock:r,clientID:t,totalLength:o,items:n.items,deleteSet:c}:{clock:r,clientID:t,totalLength:o,items:n.items}}function $(t){return{client:K.l(t),clock:K.l(t)}}var tt=function t(e,n,c,r,o,a,s,i,u){var l=this;Object(Y.a)(this,t),this.client=e,this.clock=n,this.left=r,this.origin=o,this.right=a,this.rightOrigin=s,this.parentYKey=i,this.parent=u,Object.keys(c).forEach((function(t){l[t]=c[t]}))};function et(t,e,n,c){var r=(c&q.g)===q.g?$(n):null,o=(c&q.f)===q.f?$(n):null,a=0===(c&(q.f|q.g)),s=!!a&&1===K.l(n),i=a&&s?K.k(n):null,u=null;a&&!s&&(u=$(n)),a&&(c&q.e)===q.e&&K.k(n);var l=function(t,e){return V[e&q.i](t)}(n,c);return new tt(t,e,l,null,r,null,o,i,u)}n(51);function nt(){var t,e=Object(c.useState)((t="scenario",new URL(window.location.href).searchParams.get(t)||h)),n=Object(p.a)(e,2),r=n[0],o=n[1],a=Object(c.useState)(0),s=Object(p.a)(a,2),v=s[0],D=s[1],S=Object(c.useState)([]),N=Object(p.a)(S,2),C=N[0],E=N[1],I=Object(c.useState)({gc:!1,pud:!1}),T=Object(p.a)(I,2),R=T[0],U=T[1];function F(t){E(t),window.docs=t}function L(t,e){return B.apply(this,arguments)}function B(){return(B=Object(d.a)(i.a.mark((function t(e,n){return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=[],t.t1=Object(u.a)(C.slice(0,e)),t.next=4,n(C[e]);case 4:t.t2=t.sent,t.t3=[t.t2],t.t4=Object(u.a)(C.slice(e+1)),F(t.t0.concat.call(t.t0,t.t1,t.t3,t.t4));case 9:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function A(){return(A=Object(d.a)(i.a.mark((function t(){var e,n,c,o;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:D(v+1),e=z[r],n=Object(p.a)(e[v],2),c=n[0],o=n[1],t.t0=c,t.next=t.t0===j?6:t.t0===b?9:t.t0===O?12:t.t0===x?15:18;break;case 6:return t.next=8,P();case 8:return t.abrupt("break",19);case 9:return t.next=11,K(o);case 11:return t.abrupt("break",19);case 12:return t.next=14,H(o);case 14:return t.abrupt("break",19);case 15:return t.next=17,J(o);case 17:return t.abrupt("break",19);case 18:throw new Error("Unexpected action: "+c);case 19:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function P(){return _.apply(this,arguments)}function _(){return(_=Object(d.a)(i.a.mark((function t(){var e,n,c,r,o;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if((e=new f.c).gc=R.gc,n=C.length,c=null,!R.pud){t.next=9;break}return(c=new f.e(e)).setUserMapping(e,e.clientID,"Doc".concat(n)),t.next=9,G(0);case 9:r=f.h(e),(o=C.filter(Boolean)).length&&n!==o[0].id&&f.g(e,f.h(o[0].yDoc)),o.forEach((function(t){f.g(t.yDoc,r)})),F([].concat(Object(u.a)(C),[{id:n,yDoc:e,pud:c,updates:[]}]));case 14:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function J(t){return Y.apply(this,arguments)}function Y(){return(Y=Object(d.a)(i.a.mark((function t(e){return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.yDoc.destroy(),t.next=3,L(e.id,(function(){return null}));case 3:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function K(t){return q.apply(this,arguments)}function q(){return(q=Object(d.a)(i.a.mark((function t(e){var n,c;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.id,c=e.actions,t.next=3,L(n,function(){var t=Object(d.a)(i.a.mark((function t(e){var r,o,a,s,d,p,h,j,b,O,x,m;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:r=[],o=f.i(e.yDoc),a=0;case 3:if(!(a<c.length)){t.next=25;break}d=c[a],p=d.type,h=d.pos,j=d.str,b=d.len,O=e.yDoc.getText(w),t.t0=p,t.next=t.t0===g?10:t.t0===y?12:14;break;case 10:return O.insert(h,j),t.abrupt("break",15);case 12:return O.delete(h,b),t.abrupt("break",15);case 14:throw new Error("Unexpected type");case 15:return t.next=17,G(0);case 17:x=f.h(e.yDoc,o),m=Z(e.yDoc.clientID,x),null===(s=m.items)||void 0===s||s.forEach((function(t){if("binary"===t.type){var e=X(t.content);Object.keys(e).length&&(t.decodedContent=e),t.content="[...]"}})),console.log("update",m),r.push({action:d,payload:x,syncedIds:[n]});case 22:a++,t.next=3;break;case 25:if(1!==C.length){t.next=27;break}return t.abrupt("return",e);case 27:return t.abrupt("return",Object(l.a)(Object(l.a)({},e),{},{updates:[].concat(Object(u.a)(e.updates),r)}));case 28:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}());case 3:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function H(t){return Q.apply(this,arguments)}function Q(){return(Q=Object(d.a)(i.a.mark((function t(e){var n,c,r;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.from,c=e.to,r=e.index,t.next=3,L(n,(function(t){if(t){var e=C[c],n=void 0===r?t.updates:[t.updates[r]];return n.forEach((function(t){f.g(e.yDoc,t.payload)})),Object(l.a)(Object(l.a)({},t),{},{updates:t.updates.map((function(t){return n.includes(t)?t.syncedIds.includes(c)?t:Object(l.a)(Object(l.a)({},t),{},{syncedIds:[].concat(Object(u.a)(t.syncedIds),[c])}):t})).filter((function(t){return t.syncedIds.length!==C.filter(Boolean).length}))})}}));case 3:case"end":return t.stop()}}),t)})))).apply(this,arguments)}var V=r===h;return Object(m.jsxs)("div",{className:"App",children:[Object(m.jsx)(k,{scenarios:z,currentScenario:r,currentScenarioStepIndex:v,onScenarioChange:function(t){o(t),D(0),F([])},onNextStep:function(){return A.apply(this,arguments)},onRestartStep:function(){D(0),F([])},onOpenDoc:P}),!z[r]&&Object(m.jsx)(W,{onOpenDoc:P,options:R,onOptionChange:function(t){U(Object(l.a)(Object(l.a)({},R),t))}}),Object(m.jsx)("div",{className:"docs-container",children:C.filter(Boolean).map((function(t){return Object(m.jsx)(M,{doc:t,docs:C,editable:V,onCloseDoc:J,onEditorChange:K,onSync:H},t.id)}))})]})}a.a.render(Object(m.jsx)(r.a.StrictMode,{children:Object(m.jsx)(nt,{})}),document.getElementById("root"))}},[[52,1,2]]]);
//# sourceMappingURL=main.c73342fe.chunk.js.map