(this["webpackJsonpdata-visualization"]=this["webpackJsonpdata-visualization"]||[]).push([[0],{35:function(t,e,n){},37:function(t,e,n){},39:function(t,e,n){},40:function(t,e,n){},41:function(t,e,n){},42:function(t,e,n){},43:function(t,e,n){},50:function(t,e,n){},51:function(t,e,n){},52:function(t,e,n){"use strict";n.r(e);var c=n(19),r=n.n(c),o=n(29),a=n.n(o),i=(n(35),n(18)),s=n.n(i),u=n(16),l=n(13),d=n(22),p=n(12),f=n(14),h="CUSTOM_SCENARIO",j=(n(37),n(4));function b(t){return Object(j.jsxs)("div",{className:"actions",children:[Object(j.jsx)("span",{children:"Actions: "}),Object(j.jsx)("button",{onClick:t.onOpenDoc,children:"Open a new doc"})]})}var O="DOC_OPEN",x="DOC_UPDATE",v="DOC_SYNC",g="DOC_CLOSE",y="INSERT",m="DELETE";n(39);function k(t){var e=Object(p.a)(t,2),n=e[0],c=e[1];switch(n){case O:return n;case x:var r=c.id;return c.actions.map((function(t){if(t.type===y)return"".concat(n," Doc:").concat(r," type:").concat(t.type," pos:").concat(t.pos," str:").concat(t.str);if(t.type===m)return"".concat(n," Doc:").concat(r," type:").concat(t.type," pos:").concat(t.pos," len:").concat(t.len);throw new Error("Unexpect edit type: "+t.type)})).join(" ; ");case v:return void 0===c.index?"".concat(n," FromDoc:").concat(c.from," ToDoc:").concat(c.to):"".concat(n," FromDoc:").concat(c.from," ToDoc:").concat(c.to," updateIndex:").concat(c.index);case g:return n;default:throw new Error("Expected action: "+n)}}function D(t){var e="scenarios";var n=t.scenarios[t.currentScenario],c=n&&n[t.currentScenarioStepIndex-1],r=n&&n[t.currentScenarioStepIndex];return Object(j.jsxs)("div",{className:"scenarios",children:[Object(j.jsx)("label",{htmlFor:e,children:"Scenarios: "}),Object(j.jsxs)("select",{id:e,onChange:function(e){e.target.value!==t.currentScenario&&t.onScenarioChange(e.target.value)},children:[Object(j.jsx)("option",{value:h,children:"Custom"}),Object.keys(t.scenarios).map((function(t){return Object(j.jsx)("option",{value:t,children:t},t)}))]}),n&&Object(j.jsx)("button",{disabled:t.currentScenario===h,onClick:function(){var e=t.scenarios[t.currentScenario];t.currentScenarioStepIndex<e.length?t.onNextStep():t.onRestartStep()},className:"next-step-button",children:r?"Next step":"Restart"}),r&&Object(j.jsx)("span",{className:"next-step",children:k(r)}),c&&Object(j.jsxs)("p",{className:"current-step",children:[Object(j.jsx)("span",{className:"current-step-label",children:"Current step: "}),Object(j.jsx)("span",{children:k(c)})]}),!n&&Object(j.jsx)(b,{onOpenDoc:function(){t.onOpenDoc()}})]})}n(40);function S(t){return Object(j.jsxs)("div",{className:"doc-tab",children:[Object(j.jsxs)("p",{className:"doc-id",children:["Doc",t.doc.id]}),t.editable&&Object(j.jsx)("button",{className:"doc-close",onClick:function(){t.onCloseDoc(t.doc)},children:"x"})]})}var w="sample-key";n(41);function N(t,e,n){var c=function(t,e,n){for(var c=Math.min(Math.max(t.length-1,0),Math.max(e.length-1,0),n),r=0;r<=c;r++)if(t[r]!==e[r])return r;return 0===t.length||0===e.length?0:c+1}(t,e,n),r=function(t,e,n){for(var c=Math.min(Math.max(t.length-1,0),Math.max(e.length-n,0)),r=0;r<=c;r++)if(t[t.length-1-r]!==e[e.length-1-r])return r;return c}(t,e,n);if(c+r>t.length-1||c+r>e.length-1){var o=function(t,e,n){if(t.length>e.length)return{type:m,pos:n,len:t.length-e.length};if(t.length<e.length){var c=n-(e.length-t.length);return{type:y,pos:c,str:e.slice(c,n)}}return null}(t,e,n);return o?[o]:[]}var a={pos:c,len:t.length-r-c},i={pos:c,str:e.slice(c,e.length-r)},s=[];return a.len&&s.push({type:m,pos:a.pos,len:a.len}),i.str.length&&s.push({type:y,pos:i.pos,str:i.str}),s}function C(t){return t.getText(w).toString()}function E(t){var e=Object(c.useRef)(null),n=Object(c.useRef)(C(t.doc.yDoc));return Object(c.useEffect)((function(){var c=C(t.doc.yDoc);e.current.textContent!==c&&(e.current.textContent=c),n.current!==c&&(n.current=c)})),Object(j.jsx)("p",{contentEditable:t.editable?"true":"false",className:"editor",onInput:function(e){var c=e.target.textContent;if(n.current!==c){var r=window.getSelection().getRangeAt(0).startOffset,o=N(n.current,c,r);o.length&&(n.current=c,t.onEditorChange({id:t.doc.id,actions:o}))}},ref:e})}n(42);function T(t){return"".concat(t.type," ").concat(t.pos," ").concat(t.str||t.len)}function I(t){function e(e,n){return function(){t.onSync({from:t.doc.id,to:e,index:n})}}return Object(j.jsx)("div",{className:"updates",children:t.doc.updates.map((function(n,c){return Object(j.jsxs)("p",{className:"update",children:[Object(j.jsx)("span",{className:"update-detail".concat(n.action.type===y?" insert":" delete"),children:T(n.action)}),t.editable&&t.docs.filter((function(e){return e&&e.id!==t.doc.id})).map((function(t){return Object(j.jsxs)("button",{className:"sync-button",onClick:e(t.id,c),children:["To Doc",t.id]},t.id)}))]},c+T(n.action))}))})}n(43);function _(t){var e=[];return t.forEach((function(t,n){e.push(Object(j.jsxs)("p",{children:[Object(j.jsxs)("span",{className:"client-id",children:[n,":"]}),Object(j.jsx)("span",{children:t})]},n))})),e}function M(t,e){if(!t)return[];var n,c=function(t){var e={client:t.id.client,clock:t.id.clock};return t.content instanceof f.b?Object(u.a)(Object(u.a)({},e),{},{deleted:!0,len:t.content.len}):t.deleted?Object(u.a)(Object(u.a)({},e),{},{deleted:!0,content:t.content.str,len:t.content.str.length}):Object(u.a)(Object(u.a)({},e),{},{deleted:!1,content:t.content.str})}(t);return[Object(j.jsxs)("div",{className:"item".concat(c.deleted?" delete":" insert").concat(c.client===e?" current":" link"),children:[Object(j.jsx)("p",{className:"clock",children:c.clock}),Object(j.jsx)("p",{className:"item-value",children:c.content||c.len})]},"".concat((n=t).id.client," ").concat(n.id.clock))].concat(Object(l.a)(M(t.right,e)))}function R(t,e){var n=[],c=new f.e(t);return c.dss.forEach((function(t,r){c.clients.get(e)===r&&t.clients.forEach((function(t,e){t.forEach((function(t){n.push(Object(j.jsxs)("div",{className:"item delete",children:[Object(j.jsx)("p",{className:"clock",children:t.clock}),Object(j.jsx)("p",{className:"item-value",children:t.len})]},"".concat(e,"-").concat(t.clock)))}))}))})),n}function F(t){var e=[];return t.yDoc.store.clients.forEach((function(n,c){e.push(Object(j.jsxs)("div",{className:"client",children:[Object(j.jsxs)("p",{className:"client-id",children:["clientID: ",c]}),Object(j.jsx)("p",{className:"label",children:"Text:"}),Object(j.jsx)("div",{className:"client-text",children:M(t.yDoc.getText(w)._start,c)}),Object(j.jsx)("p",{className:"label",children:"DeleteSet:"}),Object(j.jsx)("div",{className:"pud",children:R(t.yDoc,c)})]},c))})),Object(j.jsxs)("div",{className:"y-doc-model",children:[t.yDoc.store.pendingStructs&&Object(j.jsxs)("div",{className:"pending-structs",children:[Object(j.jsx)("p",{children:"missing:"}),_(t.yDoc.store.pendingStructs.missing)]}),Object(j.jsx)("div",{className:"clients",children:e})]})}n(50);function U(t){return Object(j.jsxs)("div",{className:"doc-container",children:[Object(j.jsx)(S,{doc:t.doc,onCloseDoc:t.onCloseDoc,editable:t.editable}),Object(j.jsx)(E,{doc:t.doc,onEditorChange:t.onEditorChange,editable:t.editable}),Object(j.jsx)(I,{doc:t.doc,docs:t.docs,onSync:t.onSync,editable:t.editable}),Object(j.jsx)(F,{yDoc:t.doc.yDoc})]})}var L=n(9),A="option-gc";function B(t){return t.target.value}function V(t){return Object(j.jsxs)("div",{className:"options-container",children:[Object(j.jsx)("label",{htmlFor:A,children:"GC:"}),Object(j.jsx)("input",{id:A,type:"checkbox",checked:t.options.gc,onChange:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:B;return function(c){t.onOptionChange(Object(L.a)({},e,n(c)))}}("gc",(function(t){return t.target.checked}))})]})}var P={DocEdit:[[O],[x,{id:0,actions:[{type:y,pos:0,str:"FOO"}]}],[x,{id:0,actions:[{type:m,pos:1,len:1}]}],[x,{id:0,actions:[{type:y,pos:1,str:"T"}]}],[x,{id:0,actions:[{type:y,pos:1,str:"B"}]}]],TwoDocsSyncWithoutConflicts:[[O],[O],[x,{id:0,actions:[{type:y,pos:0,str:"FOO"}]}],[v,{from:0,to:1}],[x,{id:1,actions:[{type:m,pos:1,len:1}]}],[x,{id:1,actions:[{type:y,pos:1,str:"T"}]}],[v,{from:1,to:0}]],TwoDocsSyncWithConflicts:[[O],[O],[x,{id:0,actions:[{type:y,pos:0,str:"FOO"}]}],[v,{from:0,to:1}],[x,{id:0,actions:[{type:y,pos:3,str:"B"}]}],[x,{id:1,actions:[{type:y,pos:3,str:"T"}]}],[v,{from:1,to:0}],[v,{from:0,to:1}]],TwoDocsSyncWithLostUpdates:[[O],[O],[x,{id:0,actions:[{type:y,pos:0,str:"FOO"}]}],[v,{from:0,to:1}],[x,{id:0,actions:[{type:y,pos:3,str:"B"}]}],[x,{id:0,actions:[{type:y,pos:4,str:"AR"}]}],[x,{id:1,actions:[{type:y,pos:3,str:"T"}]}],[v,{from:0,to:1,index:1}],[v,{from:1,to:0}],[v,{from:0,to:1,index:0}]]};function J(t){return new Promise((function(e){setTimeout(e,t)}))}var W=n(2),z=n(0),Y=n(3),G=n(11),K=[function(){return new f.a},function(){return new f.d},function(){return new f.f},function(t){z.j(t)},function(t){},function(t){z.j(t)},function(t){}];var q=[function(){throw G.c()},function(t){return{type:"deleted",length:z.k(t)}},function(t){for(var e=z.k(t),n=[],c=0;c<e;c++){var r=z.j(t);"undefined"===r?n.push(void 0):n.push(JSON.parse(r))}return{type:"json",content:n,length:e}},function(t){return{type:"binary",content:z.l(t),length:1}},function(t){var e=z.j(t);return{type:"string",string:e,length:e.length}},function(t){return{type:"embed",content:z.j(t),length:1}},function(t){return{type:"format",content:{key:z.j(t),value:z.j(t)},length:1}},function(t){return{type:"type",content:K[z.k(t)](t),length:1}},function(t){for(var e=z.k(t),n=[],c=0;c<e;c++){var r=z.g(t);n.push(r)}return{type:"any",content:n,length:e}}];function H(t,e){var n=function(t){for(var e=new Map,n=z.k(t),c=0,r=0;r<n;r++){for(var o=z.k(t),a=[],i=Q(t),s=i.clock,u=i.client,l=0;l<o;l++){var d=z.h(t),p=void 0;p=0!==(Y.i&d)?Z(u,s,t,d):new X(u,s,{length:z.k(t)}),a.push(p),s+=p.length,c+=p.length}e.set(u,{items:a,totalLength:c})}return e}(z.e(e)).get(t);return null==n?{clientID:t}:{clock:n.items[0].clock,clientID:t,totalLength:n.totalLength,items:n.items}}function Q(t){return{client:z.k(t),clock:z.k(t)}}var X=function t(e,n,c,r,o,a,i,s,u){var l=this;Object(W.a)(this,t),this.client=e,this.clock=n,this.left=r,this.origin=o,this.right=a,this.rightOrigin=i,this.parentYKey=s,this.parent=u,Object.keys(c).forEach((function(t){l[t]=c[t]}))};function Z(t,e,n,c){var r=(c&Y.g)===Y.g?Q(n):null,o=(c&Y.f)===Y.f?Q(n):null,a=0===(c&(Y.f|Y.g)),i=!!a&&1===z.k(n),s=a&&i?z.j(n):null,u=null;a&&!i&&(u=Q(n)),a&&(c&Y.e)===Y.e&&z.j(n);var l=function(t,e){return q[e&Y.i](t)}(n,c);return new X(t,e,l,null,r,null,o,s,u)}function $(t){for(var e={clients:{}},n=z.e(t),c=z.k(n),r=0;r<c;r++){var o=z.k(n),a=z.k(n);if(a>0){e.clients[o]=[];for(var i=0;i<a;i++)e.clients[o].push({clock:z.k(n),length:z.k(n)})}}return e}n(51);function tt(){var t,e=Object(c.useState)((t="scenario",new URL(window.location.href).searchParams.get(t)||h)),n=Object(p.a)(e,2),r=n[0],o=n[1],a=Object(c.useState)(0),i=Object(p.a)(a,2),b=i[0],k=i[1],S=Object(c.useState)([]),N=Object(p.a)(S,2),C=N[0],E=N[1],T=Object(c.useState)({gc:!0}),I=Object(p.a)(T,2),_=I[0],M=I[1];function R(t){E(t),window.docs=t}function F(t,e){return L.apply(this,arguments)}function L(){return(L=Object(d.a)(s.a.mark((function t(e,n){return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=[],t.t1=Object(l.a)(C.slice(0,e)),t.next=4,n(C[e]);case 4:t.t2=t.sent,t.t3=[t.t2],t.t4=Object(l.a)(C.slice(e+1)),R(t.t0.concat.call(t.t0,t.t1,t.t3,t.t4));case 9:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function A(){return(A=Object(d.a)(s.a.mark((function t(){var e,n,c,o;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:k(b+1),e=P[r],n=Object(p.a)(e[b],2),c=n[0],o=n[1],t.t0=c,t.next=t.t0===O?6:t.t0===x?8:t.t0===v?11:t.t0===g?14:17;break;case 6:return B(),t.abrupt("break",18);case 8:return t.next=10,Y(o);case 10:return t.abrupt("break",18);case 11:return t.next=13,K(o);case 13:return t.abrupt("break",18);case 14:return t.next=16,W(o);case 16:return t.abrupt("break",18);case 17:throw new Error("Unexpected action: "+c);case 18:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function B(){var t=new f.c;t.gc=_.gc;var e=new f.e(t);t._prevStateVector=f.i(t);var n=C.length;e.setUserMapping(t,t.clientID,"Doc".concat(n));var c=f.h(t,t._prevStateVector);t._prevStateVector=f.i(t),0!==n&&f.g(t,f.h(C[0].yDoc)),C.forEach((function(t){f.g(t.yDoc,c)})),R([].concat(Object(l.a)(C),[{id:n,yDoc:t,pud:e,updates:[]}]))}function W(t){return z.apply(this,arguments)}function z(){return(z=Object(d.a)(s.a.mark((function t(e){return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.yDoc.destroy(),t.next=3,F(e.id,(function(){return null}));case 3:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function Y(t){return G.apply(this,arguments)}function G(){return(G=Object(d.a)(s.a.mark((function t(e){var n,c;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.id,c=e.actions,t.next=3,F(n,function(){var t=Object(d.a)(s.a.mark((function t(e){var n,r,o,a,i,d,p,h,j,b;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=[],r=0;case 2:if(!(r<c.length)){t.next=25;break}o=c[r],a=o.type,i=o.pos,d=o.str,p=o.len,h=e.yDoc.getText(w),t.t0=a,t.next=t.t0===y?9:t.t0===m?11:13;break;case 9:return h.insert(i,d),t.abrupt("break",14);case 11:return h.delete(i,p),t.abrupt("break",14);case 13:throw new Error("Unexpected type");case 14:return t.next=16,J(0);case 16:j=f.h(e.yDoc,e.yDoc._prevStateVector),e.yDoc._prevStateVector=f.i(e.yDoc),(b=H(e.yDoc.clientID,j)).items.forEach((function(t){"binary"===t.type&&(t.decodedContent=$(t.content),t.content="[...]")})),console.log("update",b),n.push({action:o,payload:j});case 22:r++,t.next=2;break;case 25:if(1!==C.length){t.next=27;break}return t.abrupt("return",e);case 27:return t.abrupt("return",Object(u.a)(Object(u.a)({},e),{},{updates:[].concat(Object(l.a)(e.updates),n)}));case 28:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}());case 3:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function K(t){return q.apply(this,arguments)}function q(){return(q=Object(d.a)(s.a.mark((function t(e){var n,c,r;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.from,c=e.to,r=e.index,t.next=3,F(n,(function(t){if(t){var e=C[c],n=void 0===r?t.updates:[t.updates[r]];return n.forEach((function(t){f.g(e.yDoc,t.payload)})),Object(u.a)(Object(u.a)({},t),{},{updates:t.updates.filter((function(t){return!n.includes(t)}))})}}));case 3:case"end":return t.stop()}}),t)})))).apply(this,arguments)}var Q=r===h;return Object(j.jsxs)("div",{className:"App",children:[Object(j.jsx)(D,{scenarios:P,currentScenario:r,currentScenarioStepIndex:b,onScenarioChange:function(t){o(t),k(0),R([])},onNextStep:function(){return A.apply(this,arguments)},onRestartStep:function(){k(0),R([])},onOpenDoc:B}),Object(j.jsx)(V,{options:_,onOptionChange:function(t){M(Object(u.a)(Object(u.a)({},_),t))}}),Object(j.jsx)("div",{className:"docs-container",children:C.filter(Boolean).map((function(t){return Object(j.jsx)(U,{doc:t,docs:C,editable:Q,onCloseDoc:W,onEditorChange:Y,onSync:K},t.id)}))})]})}a.a.render(Object(j.jsx)(r.a.StrictMode,{children:Object(j.jsx)(tt,{})}),document.getElementById("root"))}},[[52,1,2]]]);
//# sourceMappingURL=main.32f2318f.chunk.js.map