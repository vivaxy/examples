(this["webpackJsonpdata-visualization"]=this["webpackJsonpdata-visualization"]||[]).push([[0],{33:function(t,e,n){},35:function(t,e,n){},36:function(t,e,n){},37:function(t,e,n){},45:function(t,e,n){"use strict";n.r(e);var c=n(15),o=n.n(c),s=n(27),i=n.n(s),r=(n(33),n(16)),a=n(11),d=n(12),l=n(23),u=n(5);function j(t){var e="scenarios";return Object(u.jsxs)("div",{className:"scenarios",children:[Object(u.jsx)("label",{htmlFor:e,children:"Scenarios:"}),Object(u.jsx)("select",{id:e,onChange:function(e){e.target.value!==t.currentScenario&&t.onScenarioChange(e.target.value)},children:Object.keys(t.scenarios).map((function(t){return Object(u.jsx)("option",{value:t,children:t},t)}))}),Object(u.jsx)("button",{disabled:!t.hasNextStep,onClick:function(){t.onNextStep()},children:"Next step"})]})}function p(t){return Object(u.jsxs)("div",{className:"actions",children:[Object(u.jsx)("span",{children:"Actions:"}),Object(u.jsx)("button",{onClick:t.onOpenDoc,children:"Open a new doc"})]})}n(35);function O(t){var e=[];return t.forEach((function(t,n){e.push(Object(u.jsxs)("p",{children:[Object(u.jsxs)("span",{className:"client-id",children:[n,":"]}),Object(u.jsx)("span",{children:t})]},n))})),e}function b(t){var e=Object(u.jsxs)("div",{className:"shared-type".concat(t.content.str?" insert":" delete"),children:[Object(u.jsx)("p",{className:"clock",children:t.id.clock}),Object(u.jsx)("p",{className:"shared-type-value",children:t.content.str||t.content.len})]},function(t){return"".concat(t.id.client," ").concat(t.id.clock)}(t));return t.right?[e].concat(Object(a.a)(b(t.right))):[e]}function h(t){var e=[];return t.yDoc.store.clients.forEach((function(t,n){e.push(Object(u.jsxs)("div",{className:"client",children:[Object(u.jsxs)("p",{className:"client-id",children:["clientID: ",n]}),Object(u.jsx)("div",{className:"client-model",children:b(t[0].parent._start)})]},n))})),Object(u.jsxs)("div",{className:"y-doc-model",children:[t.yDoc.store.pendingStructs&&Object(u.jsxs)("div",{className:"pending-structs",children:[Object(u.jsx)("p",{children:"missing:"}),O(t.yDoc.store.pendingStructs.missing)]}),Object(u.jsx)("div",{className:"clients",children:e})]})}n(36);var f="INSERT",x="DELETE",g="sample-key";function y(t){return"".concat(t.type," ").concat(t.pos," ").concat(t.str||t.len)}function m(t){return t.getText(g).toString()}function v(t){var e=Object(c.useRef)(null),n=Object(c.useRef)(m(t.doc.yDoc));function o(e,n){return function(){t.onSync({fromDocId:t.doc.id,toDocId:e,update:n})}}return Object(c.useEffect)((function(){var c=m(t.doc.yDoc);e.current.textContent!==c&&(e.current.textContent=c),n.current!==c&&(n.current=c)})),Object(u.jsxs)("div",{className:"doc-container",children:[Object(u.jsxs)("div",{className:"doc-tab",children:[Object(u.jsxs)("p",{className:"doc-id",children:["Doc",t.doc.id]}),Object(u.jsx)("button",{className:"doc-close",onClick:function(){t.onCloseDoc(t.doc)},children:"x"})]}),Object(u.jsx)("p",{contentEditable:"true",className:"editor",onInput:function(e){var c=e.target.textContent;if(n.current!==c){var o=window.getSelection().getRangeAt(0).startOffset,s=function(t,e,n){if(e.length>t.length)return{type:f,pos:n-e.length+t.length,str:e.slice(n-e.length+t.length,n)};if(e.length<t.length)return{type:x,pos:n,len:t.length-e.length};throw new Error("Unexpected change")}(n.current,c,o);n.current=c,t.onEditorChange(Object(r.a)({id:t.doc.id},s))}},ref:e}),Object(u.jsx)("div",{className:"updates",children:t.doc.updates.map((function(e,n){return Object(u.jsxs)("p",{className:"update",children:[Object(u.jsx)("span",{className:"update-detail".concat(e.action.type===f?" insert":" delete"),children:y(e.action)}),t.docs.filter((function(e){return e.id!==t.doc.id})).map((function(t){return Object(u.jsxs)("button",{className:"sync-button",onClick:o(t.id,e),children:["To Doc",t.id]},t.id)}))]},n+y(e.action))}))}),Object(u.jsx)(h,{yDoc:t.doc.yDoc})]})}var D="DOC_OPEN",N="DOC_UPDATE",S="DOC_SYNC",C={docEdit:[[D],[N,{id:0,type:f,pos:0,string:"FOO"}],[N,{id:0,type:x,pos:1,length:1}],[N,{id:0,type:f,pos:1,string:"T"}],[N,{id:0,type:f,pos:1,string:"B"}]],twoDocsSyncWithoutConflicts:[[D],[D],[N,{id:0,type:f,pos:0,string:"FOO"}],[S,{from:0,to:1}],[N,{id:1,type:x,pos:1,length:1}],[N,{id:1,type:f,pos:1,string:"T"}],[S,{from:1,to:0}]],twoDocsSyncWithConflicts:[[D],[D],[N,{id:0,type:f,pos:0,string:"FOO"}],[S,{from:0,to:1}],[N,{id:0,type:f,pos:3,string:"B"}],[N,{id:1,type:f,pos:3,string:"T"}],[S,{from:1,to:0}],[S,{from:0,to:1}]],twoDocsSyncWithLostUpdates:[[D],[D],[N,{id:0,type:f,pos:0,string:"FOO"}],[S,{from:0,to:1}],[S,{id:0,type:f,pos:3,string:"B"}],[S,{id:1,type:f,pos:3,string:"T"}],[S,{from:1,to:0}],[S,{from:0,to:1}]]};n(37);function E(){var t=Object(c.useState)(Object.keys(C)[0]),e=Object(d.a)(t,2),n=e[0],o=e[1],s=Object(c.useState)(0),i=Object(d.a)(s,2),O=i[0],b=i[1],h=Object(c.useState)([]),y=Object(d.a)(h,2),m=y[0],D=y[1];function N(t,e){var n=[].concat(Object(a.a)(m.slice(0,t)),[e(m[t])],Object(a.a)(m.slice(t+1)));D(n)}function S(t){t.yDoc.destroy(),N(t.id,(function(){return null}))}function E(t){var e=t.id,n=t.type,c=t.pos,o=t.str,s=t.len;N(e,(function(e){var i=l.d(e.yDoc),d=e.yDoc.getText(g);switch(n){case f:d.insert(c,o);break;case x:d.delete(c,s);break;default:throw new Error("Unexpected type")}var u=l.c(e.yDoc,i);return Object(r.a)(Object(r.a)({},e),{},{updates:[].concat(Object(a.a)(e.updates),[{action:t,payload:u}])})}))}function k(t){var e=t.fromDocId,n=t.toDocId,c=t.update;N(e,(function(t){var e=m[n];return l.b(e.yDoc,c.payload),Object(r.a)(Object(r.a)({},t),{},{updates:t.updates.filter((function(t){return t!==c}))})}))}var w=O<C[n].length;return Object(u.jsxs)("div",{className:"App",children:[Object(u.jsx)(j,{scenarios:C,currentScenario:n,onScenarioChange:function(t){o(t),b(0)},hasNextStep:w,onNextStep:function(){O<C[n].length?b(O+1):b(0)}}),Object(u.jsx)(p,{onOpenDoc:function(){var t=new l.a;D([].concat(Object(a.a)(m),[{id:m.length,yDoc:t,updates:[]}]))}}),Object(u.jsx)("div",{className:"docs-container",children:m.filter(Boolean).map((function(t){return Object(u.jsx)(v,{doc:t,docs:m,onCloseDoc:S,onEditorChange:E,onSync:k},t.id)}))})]})}i.a.render(Object(u.jsx)(o.a.StrictMode,{children:Object(u.jsx)(E,{})}),document.getElementById("root"))}},[[45,1,2]]]);
//# sourceMappingURL=main.e07b8752.chunk.js.map