(this["webpackJsonpdata-visualization"]=this["webpackJsonpdata-visualization"]||[]).push([[0],{34:function(t,e,n){},36:function(t,e,n){},38:function(t,e,n){},39:function(t,e,n){},40:function(t,e,n){},41:function(t,e,n){},42:function(t,e,n){},49:function(t,e,n){},50:function(t,e,n){},51:function(t,e,n){"use strict";n.r(e);var c=n(17),r=n.n(c),o=n(28),a=n.n(o),s=(n(34),n(18)),i=n(15),u=n.n(i),l=n(12),d=n(21),p=n(11),f=n(16),j="CUSTOM_SCENARIO",h=(n(36),n(3));function b(t){return Object(h.jsxs)("div",{className:"actions",children:[Object(h.jsx)("span",{children:"Actions: "}),Object(h.jsx)("button",{onClick:t.onOpenDoc,children:"Open a new doc"})]})}var x="DOC_OPEN",O="DOC_UPDATE",m="DOC_SYNC",y="DOC_CLOSE",v="INSERT",g="DELETE";n(38);function D(t){var e=Object(p.a)(t,2),n=e[0],c=e[1];switch(n){case x:return n;case O:var r=c.id;return c.actions.map((function(t){if(t.type===v)return"".concat(n," Doc:").concat(r," type:").concat(t.type," pos:").concat(t.pos," str:").concat(t.str);if(t.type===g)return"".concat(n," Doc:").concat(r," type:").concat(t.type," pos:").concat(t.pos," len:").concat(t.len);throw new Error("Unexpect edit type: "+t.type)})).join(" ; ");case m:return void 0===c.index?"".concat(n," FromDoc:").concat(c.from," ToDoc:").concat(c.to):"".concat(n," FromDoc:").concat(c.from," ToDoc:").concat(c.to," updateIndex:").concat(c.index);case y:return n;default:throw new Error("Expected action: "+n)}}function S(t){var e="scenarios";var n=t.scenarios[t.currentScenario],c=n&&n[t.currentScenarioStepIndex-1],r=n&&n[t.currentScenarioStepIndex];return Object(h.jsxs)("div",{className:"scenarios",children:[Object(h.jsx)("label",{htmlFor:e,children:"Scenarios: "}),Object(h.jsxs)("select",{id:e,onChange:function(e){e.target.value!==t.currentScenario&&t.onScenarioChange(e.target.value)},children:[Object(h.jsx)("option",{value:j,children:"Custom"}),Object.keys(t.scenarios).map((function(t){return Object(h.jsx)("option",{value:t,children:t},t)}))]}),n&&Object(h.jsx)("button",{disabled:t.currentScenario===j,onClick:function(){var e=t.scenarios[t.currentScenario];t.currentScenarioStepIndex<e.length?t.onNextStep():t.onRestartStep()},className:"next-step-button",children:r?"Next step":"Restart"}),r&&Object(h.jsx)("span",{className:"next-step",children:D(r)}),c&&Object(h.jsxs)("p",{className:"current-step",children:[Object(h.jsx)("span",{className:"current-step-label",children:"Current step: "}),Object(h.jsx)("span",{children:D(c)})]}),!n&&Object(h.jsx)(b,{onOpenDoc:function(){t.onOpenDoc()}})]})}n(39);function N(t){return Object(h.jsxs)("div",{className:"doc-tab",children:[Object(h.jsxs)("p",{className:"doc-id",children:["Doc",t.doc.id]}),Object(h.jsx)("button",{className:"doc-close",onClick:function(){t.onCloseDoc(t.doc)},children:"x"})]})}var w="sample-key";n(40);function k(t,e,n){var c=function(t,e,n){for(var c=Math.min(Math.max(t.length-1,0),Math.max(e.length-1,0),n),r=0;r<=c;r++)if(t[r]!==e[r])return r;return 0===t.length||0===e.length?0:c+1}(t,e,n),r=function(t,e,n){for(var c=Math.min(Math.max(t.length-1,0),Math.max(e.length-n,0)),r=0;r<=c;r++)if(t[t.length-1-r]!==e[e.length-1-r])return r;return c}(t,e,n);if(c+r>t.length-1||c+r>e.length-1){var o=function(t,e,n){if(t.length>e.length)return{type:g,pos:n,len:t.length-e.length};if(t.length<e.length){var c=n-(e.length-t.length);return{type:v,pos:c,str:e.slice(c,n)}}return null}(t,e,n);return o?[o]:[]}var a={pos:c,len:t.length-r-c},s={pos:c,str:e.slice(c,e.length-r)},i=[];return a.len&&i.push({type:g,pos:a.pos,len:a.len}),s.str.length&&i.push({type:v,pos:s.pos,str:s.str}),i}function C(t){return t.getText(w).toString()}function E(t){var e=Object(c.useRef)(null),n=Object(c.useRef)(C(t.doc.yDoc));return Object(c.useEffect)((function(){var c=C(t.doc.yDoc);e.current.textContent!==c&&(e.current.textContent=c),n.current!==c&&(n.current=c)})),Object(h.jsx)("p",{contentEditable:t.editable?"true":"false",className:"editor",onInput:function(e){var c=e.target.textContent;if(n.current!==c){var r=window.getSelection().getRangeAt(0).startOffset,o=k(n.current,c,r);o.length&&(n.current=c,t.onEditorChange({id:t.doc.id,actions:o}))}},ref:e})}n(41);function T(t){return"".concat(t.type," ").concat(t.pos," ").concat(t.str||t.len)}function I(t){function e(e,n){return function(){t.onSync({from:t.doc.id,to:e,index:n})}}return Object(h.jsx)("div",{className:"updates",children:t.doc.updates.map((function(n,c){return Object(h.jsxs)("p",{className:"update",children:[Object(h.jsx)("span",{className:"update-detail".concat(n.action.type===v?" insert":" delete"),children:T(n.action)}),t.editable&&t.docs.filter((function(e){return e&&e.id!==t.doc.id})).map((function(t){return Object(h.jsxs)("button",{className:"sync-button",onClick:e(t.id,c),children:["To Doc",t.id]},t.id)}))]},c+T(n.action))}))})}n(42);function _(t){var e=[];return t.forEach((function(t,n){e.push(Object(h.jsxs)("p",{children:[Object(h.jsxs)("span",{className:"client-id",children:[n,":"]}),Object(h.jsx)("span",{children:t})]},n))})),e}function R(t,e){return t?[Object(h.jsxs)("div",{className:"item".concat(t.content.str?" insert":" delete").concat(t.id.client===e?" current":" link"),children:[Object(h.jsx)("p",{className:"clock",children:t.id.clock}),Object(h.jsx)("p",{className:"item-value",children:t.content.str||t.content.len})]},"".concat((n=t).id.client," ").concat(n.id.clock))].concat(Object(l.a)(R(t.right,e))):[];var n}function M(t,e){var n=[],c=new f.b(t);return c.dss.forEach((function(t,r){c.clients.get(e)===r&&t.clients.forEach((function(t,e){t.forEach((function(t){n.push(Object(h.jsxs)("div",{className:"item delete",children:[Object(h.jsx)("p",{className:"clock",children:t.clock}),Object(h.jsx)("p",{className:"item-value",children:t.len})]},"".concat(e,"-").concat(t.clock)))}))}))})),n}function U(t){var e=[];return t.yDoc.store.clients.forEach((function(n,c){e.push(Object(h.jsxs)("div",{className:"client",children:[Object(h.jsxs)("p",{className:"client-id",children:["clientID: ",c]}),Object(h.jsx)("p",{className:"label",children:"Text:"}),Object(h.jsx)("div",{className:"client-text",children:R(t.yDoc.getText(w)._start,c)}),Object(h.jsx)("p",{className:"label",children:"DeleteSet:"}),Object(h.jsx)("div",{className:"pud",children:M(t.yDoc,c)})]},c))})),Object(h.jsxs)("div",{className:"y-doc-model",children:[t.yDoc.store.pendingStructs&&Object(h.jsxs)("div",{className:"pending-structs",children:[Object(h.jsx)("p",{children:"missing:"}),_(t.yDoc.store.pendingStructs.missing)]}),Object(h.jsx)("div",{className:"clients",children:e})]})}n(49);function F(t){return Object(h.jsxs)("div",{className:"doc-container",children:[Object(h.jsx)(N,{doc:t.doc,onCloseDoc:t.onCloseDoc}),Object(h.jsx)(E,{doc:t.doc,onEditorChange:t.onEditorChange,editable:t.editable}),Object(h.jsx)(I,{doc:t.doc,docs:t.docs,onSync:t.onSync,editable:t.editable}),Object(h.jsx)(U,{yDoc:t.doc.yDoc})]})}var A={DocEdit:[[x],[O,{id:0,actions:[{type:v,pos:0,str:"FOO"}]}],[O,{id:0,actions:[{type:g,pos:1,len:1}]}],[O,{id:0,actions:[{type:v,pos:1,str:"T"}]}],[O,{id:0,actions:[{type:v,pos:1,str:"B"}]}]],TwoDocsSyncWithoutConflicts:[[x],[x],[O,{id:0,actions:[{type:v,pos:0,str:"FOO"}]}],[m,{from:0,to:1}],[O,{id:1,actions:[{type:g,pos:1,len:1}]}],[O,{id:1,actions:[{type:v,pos:1,str:"T"}]}],[m,{from:1,to:0}]],TwoDocsSyncWithConflicts:[[x],[x],[O,{id:0,actions:[{type:v,pos:0,str:"FOO"}]}],[m,{from:0,to:1}],[O,{id:0,actions:[{type:v,pos:3,str:"B"}]}],[O,{id:1,actions:[{type:v,pos:3,str:"T"}]}],[m,{from:1,to:0}],[m,{from:0,to:1}]],TwoDocsSyncWithLostUpdates:[[x],[x],[O,{id:0,actions:[{type:v,pos:0,str:"FOO"}]}],[m,{from:0,to:1}],[O,{id:0,actions:[{type:v,pos:3,str:"B"}]}],[O,{id:0,actions:[{type:v,pos:4,str:"AR"}]}],[O,{id:1,actions:[{type:v,pos:3,str:"T"}]}],[m,{from:0,to:1,index:1}],[m,{from:1,to:0}],[m,{from:0,to:1,index:0}]]};function B(t){return new Promise((function(e){setTimeout(e,t)}))}n(50);function V(){var t,e=Object(c.useState)((t="scenario",new URL(window.location.href).searchParams.get(t)||j)),n=Object(p.a)(e,2),r=n[0],o=n[1],a=Object(c.useState)(0),i=Object(p.a)(a,2),b=i[0],D=i[1],N=Object(c.useState)([]),k=Object(p.a)(N,2),C=k[0],E=k[1];function T(t){E(t),window.docs=t}function I(t,e){return _.apply(this,arguments)}function _(){return(_=Object(d.a)(u.a.mark((function t(e,n){return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=[],t.t1=Object(l.a)(C.slice(0,e)),t.next=4,n(C[e]);case 4:t.t2=t.sent,t.t3=[t.t2],t.t4=Object(l.a)(C.slice(e+1)),T(t.t0.concat.call(t.t0,t.t1,t.t3,t.t4));case 9:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function R(){return(R=Object(d.a)(u.a.mark((function t(){var e,n,c,o;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:D(b+1),e=A[r],n=Object(p.a)(e[b],2),c=n[0],o=n[1],t.t0=c,t.next=t.t0===x?6:t.t0===O?8:t.t0===m?11:t.t0===y?14:17;break;case 6:return M(),t.abrupt("break",18);case 8:return t.next=10,L(o);case 10:return t.abrupt("break",18);case 11:return t.next=13,W(o);case 13:return t.abrupt("break",18);case 14:return t.next=16,U(o);case 16:return t.abrupt("break",18);case 17:throw new Error("Unexpected action: "+c);case 18:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function M(){var t=new f.a,e=new f.b(t);t._prevStateVector=f.e(t);var n=C.length;e.setUserMapping(t,t.clientID,"Doc".concat(n));var c=f.d(t,t._prevStateVector);t._prevStateVector=f.e(t),0!==n&&f.c(t,f.d(C[0].yDoc)),C.forEach((function(t){f.c(t.yDoc,c)})),T([].concat(Object(l.a)(C),[{id:n,yDoc:t,pud:e,updates:[]}]))}function U(t){return V.apply(this,arguments)}function V(){return(V=Object(d.a)(u.a.mark((function t(e){return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.yDoc.destroy(),t.next=3,I(e.id,(function(){return null}));case 3:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function L(t){return P.apply(this,arguments)}function P(){return(P=Object(d.a)(u.a.mark((function t(e){var n,c;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.id,c=e.actions,t.next=3,I(n,function(){var t=Object(d.a)(u.a.mark((function t(e){var n,r,o,a,i,d,p,j,h;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=[],r=0;case 2:if(!(r<c.length)){t.next=22;break}o=c[r],a=o.type,i=o.pos,d=o.str,p=o.len,j=e.yDoc.getText(w),t.t0=a,t.next=t.t0===v?9:t.t0===g?11:13;break;case 9:return j.insert(i,d),t.abrupt("break",14);case 11:return j.delete(i,p),t.abrupt("break",14);case 13:throw new Error("Unexpected type");case 14:return t.next=16,B(0);case 16:h=f.d(e.yDoc,e.yDoc._prevStateVector),e._prevStateVector=f.e(e.yDoc),n.push({action:o,payload:h});case 19:r++,t.next=2;break;case 22:if(1!==C.length){t.next=24;break}return t.abrupt("return",e);case 24:return t.abrupt("return",Object(s.a)(Object(s.a)({},e),{},{updates:[].concat(Object(l.a)(e.updates),n)}));case 25:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}());case 3:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function W(t){return z.apply(this,arguments)}function z(){return(z=Object(d.a)(u.a.mark((function t(e){var n,c,r;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.from,c=e.to,r=e.index,t.next=3,I(n,(function(t){if(t){var e=C[c],n=void 0===r?t.updates:[t.updates[r]];return n.forEach((function(t){f.c(e.yDoc,t.payload)})),Object(s.a)(Object(s.a)({},t),{},{updates:t.updates.filter((function(t){return!n.includes(t)}))})}}));case 3:case"end":return t.stop()}}),t)})))).apply(this,arguments)}var J=r===j;return Object(h.jsxs)("div",{className:"App",children:[Object(h.jsx)(S,{scenarios:A,currentScenario:r,currentScenarioStepIndex:b,onScenarioChange:function(t){o(t),D(0),T([])},onNextStep:function(){return R.apply(this,arguments)},onRestartStep:function(){D(0),T([])},onOpenDoc:M}),Object(h.jsx)("div",{className:"docs-container",children:C.filter(Boolean).map((function(t){return Object(h.jsx)(F,{doc:t,docs:C,editable:J,onCloseDoc:U,onEditorChange:L,onSync:W},t.id)}))})]})}a.a.render(Object(h.jsx)(r.a.StrictMode,{children:Object(h.jsx)(V,{})}),document.getElementById("root"))}},[[51,1,2]]]);
//# sourceMappingURL=main.0cb5db91.chunk.js.map