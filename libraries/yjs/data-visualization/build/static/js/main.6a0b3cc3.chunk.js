(this["webpackJsonpdata-visualization"]=this["webpackJsonpdata-visualization"]||[]).push([[0],{33:function(e,t,c){},34:function(e,t,c){},36:function(e,t,c){},37:function(e,t,c){},38:function(e,t,c){},39:function(e,t,c){},40:function(e,t,c){},41:function(e,t,c){},42:function(e,t,c){},50:function(e,t,c){"use strict";c.r(t);var n=c(15),o=c.n(n),r=c(27),s=c.n(r),a=(c(33),c(16)),i=c(12),d=c(11),l=c(23),u="CUSTOM_SCENARIO",p=(c(34),c(4));function j(e){return Object(p.jsxs)("div",{className:"actions",children:[Object(p.jsx)("span",{children:"Actions: "}),Object(p.jsx)("button",{onClick:e.onOpenDoc,children:"Open a new doc"})]})}var b="DOC_OPEN",f="DOC_UPDATE",O="DOC_SYNC",h="DOC_CLOSE",x="INSERT",y="DELETE";c(36);function m(e){var t=Object(d.a)(e,2),c=t[0],n=t[1];switch(c){case b:return c;case f:if(n.type===x)return"".concat(c," Doc:").concat(n.id," type:").concat(n.type," pos:").concat(n.pos," str:").concat(n.str);if(n.type===y)return"".concat(c," Doc:").concat(n.id," type:").concat(n.type," pos:").concat(n.pos," len:").concat(n.len);throw new Error("Unexpect edit type: "+n.type);case O:return void 0===n.index?"".concat(c," FromDoc:").concat(n.from," ToDoc:").concat(n.to):"".concat(c," FromDoc:").concat(n.from," ToDoc:").concat(n.to," updateIndex:").concat(n.index);case h:return c;default:throw new Error("Expected action: "+c)}}function v(e){var t="scenarios";var c=e.scenarios[e.currentScenario],n=c&&c[e.currentScenarioStepIndex-1],o=c&&c[e.currentScenarioStepIndex];return Object(p.jsxs)("div",{className:"scenarios",children:[Object(p.jsx)("label",{htmlFor:t,children:"Scenarios: "}),Object(p.jsxs)("select",{id:t,onChange:function(t){t.target.value!==e.currentScenario&&e.onScenarioChange(t.target.value)},children:[Object(p.jsx)("option",{value:u,children:"Custom"}),Object.keys(e.scenarios).map((function(e){return Object(p.jsx)("option",{value:e,children:e},e)}))]}),c&&Object(p.jsx)("button",{disabled:e.currentScenario===u,onClick:function(){var t=e.scenarios[e.currentScenario];e.currentScenarioStepIndex<t.length?e.onNextStep():e.onRestartStep()},className:"next-step-button",children:o?"Next step":"Restart"}),o&&Object(p.jsx)("span",{className:"next-step",children:m(o)}),n&&Object(p.jsxs)("p",{className:"current-step",children:[Object(p.jsx)("span",{className:"current-step-label",children:"Current step: "}),Object(p.jsx)("span",{children:m(n)})]}),!c&&Object(p.jsx)(j,{onOpenDoc:function(){e.onOpenDoc()}})]})}c(37);function D(e){return Object(p.jsxs)("div",{className:"doc-tab",children:[Object(p.jsxs)("p",{className:"doc-id",children:["Doc",e.doc.id]}),Object(p.jsx)("button",{className:"doc-close",onClick:function(){e.onCloseDoc(e.doc)},children:"x"})]})}var S="sample-key";c(38);function g(e){return e.getText(S).toString()}function N(e){var t=Object(n.useRef)(null),c=Object(n.useRef)(g(e.doc.yDoc));return Object(n.useEffect)((function(){var n=g(e.doc.yDoc);t.current.textContent!==n&&(t.current.textContent=n),c.current!==n&&(c.current=n)})),Object(p.jsx)("p",{contentEditable:e.editable?"true":"false",className:"editor",onInput:function(t){var n=t.target.textContent;if(c.current!==n){var o=window.getSelection().getRangeAt(0).startOffset,r=function(e,t,c){if(t.length>e.length)return{type:x,pos:c-t.length+e.length,str:t.slice(c-t.length+e.length,c)};if(t.length<e.length)return{type:y,pos:c,len:e.length-t.length};throw new Error("Unexpected change")}(c.current,n,o);c.current=n,e.onEditorChange(Object(a.a)({id:e.doc.id},r))}},ref:t})}c(39);function C(e){return"".concat(e.type," ").concat(e.pos," ").concat(e.str||e.len)}function w(e){function t(t,c){return function(){e.onSync({from:e.doc.id,to:t,index:c})}}return Object(p.jsx)("div",{className:"updates",children:e.doc.updates.map((function(c,n){return Object(p.jsxs)("p",{className:"update",children:[Object(p.jsx)("span",{className:"update-detail".concat(c.action.type===x?" insert":" delete"),children:C(c.action)}),e.editable&&e.docs.filter((function(t){return t&&t.id!==e.doc.id})).map((function(e){return Object(p.jsxs)("button",{className:"sync-button",onClick:t(e.id,n),children:["To Doc",e.id]},e.id)}))]},n+C(c.action))}))})}c(40);function E(e){var t=[];return e.forEach((function(e,c){t.push(Object(p.jsxs)("p",{children:[Object(p.jsxs)("span",{className:"client-id",children:[c,":"]}),Object(p.jsx)("span",{children:e})]},c))})),t}function k(e,t){var c=Object(p.jsxs)("div",{className:"shared-type".concat(e.content.str?" insert":" delete").concat(e.id.client===t?" current":" link"),children:[Object(p.jsx)("p",{className:"clock",children:e.id.clock}),Object(p.jsx)("p",{className:"shared-type-value",children:e.content.str||e.content.len})]},function(e){return"".concat(e.id.client," ").concat(e.id.clock)}(e));return e.right?[c].concat(Object(i.a)(k(e.right,t))):[c]}function T(e){var t=[];return e.yDoc.store.clients.forEach((function(e,c){t.push(Object(p.jsxs)("div",{className:"client",children:[Object(p.jsxs)("p",{className:"client-id",children:["clientID: ",c]}),Object(p.jsx)("div",{className:"client-model",children:k(e[0].parent._start,c)})]},c))})),Object(p.jsxs)("div",{className:"y-doc-model",children:[e.yDoc.store.pendingStructs&&Object(p.jsxs)("div",{className:"pending-structs",children:[Object(p.jsx)("p",{children:"missing:"}),E(e.yDoc.store.pendingStructs.missing)]}),Object(p.jsx)("div",{className:"clients",children:t})]})}c(41);function I(e){return Object(p.jsxs)("div",{className:"doc-container",children:[Object(p.jsx)(D,{doc:e.doc,onCloseDoc:e.onCloseDoc}),Object(p.jsx)(N,{doc:e.doc,onEditorChange:e.onEditorChange,editable:e.editable}),Object(p.jsx)(w,{doc:e.doc,docs:e.docs,onSync:e.onSync,editable:e.editable}),Object(p.jsx)(T,{yDoc:e.doc.yDoc})]})}var R={DocEdit:[[b],[f,{id:0,type:x,pos:0,str:"FOO"}],[f,{id:0,type:y,pos:1,len:1}],[f,{id:0,type:x,pos:1,str:"T"}],[f,{id:0,type:x,pos:1,str:"B"}]],TwoDocsSyncWithoutConflicts:[[b],[b],[f,{id:0,type:x,pos:0,str:"FOO"}],[O,{from:0,to:1}],[f,{id:1,type:y,pos:1,len:1}],[f,{id:1,type:x,pos:1,str:"T"}],[O,{from:1,to:0}]],TwoDocsSyncWithConflicts:[[b],[b],[f,{id:0,type:x,pos:0,str:"FOO"}],[O,{from:0,to:1}],[f,{id:0,type:x,pos:3,str:"B"}],[f,{id:1,type:x,pos:3,str:"T"}],[O,{from:1,to:0}],[O,{from:0,to:1}]],TwoDocsSyncWithLostUpdates:[[b],[b],[f,{id:0,type:x,pos:0,str:"FOO"}],[O,{from:0,to:1}],[f,{id:0,type:x,pos:3,str:"B"}],[f,{id:0,type:x,pos:4,str:"AR"}],[f,{id:1,type:x,pos:3,str:"T"}],[O,{from:0,to:1,index:1}],[O,{from:1,to:0}],[O,{from:0,to:1,index:0}]]};c(42);function U(){var e,t=Object(n.useState)((e="scenario",new URL(window.location.href).searchParams.get(e)||u)),c=Object(d.a)(t,2),o=c[0],r=c[1],s=Object(n.useState)(0),j=Object(d.a)(s,2),m=j[0],D=j[1],g=Object(n.useState)([]),N=Object(d.a)(g,2),C=N[0],w=N[1];function E(e){w(e),window.docs=e}function k(e,t){E([].concat(Object(i.a)(C.slice(0,e)),[t(C[e])],Object(i.a)(C.slice(e+1))))}function T(){var e=new l.a;E([].concat(Object(i.a)(C),[{id:C.length,yDoc:e,updates:[]}]))}function U(e){e.yDoc.destroy(),k(e.id,(function(){return null}))}function F(e){var t=e.id,c=e.type,n=e.pos,o=e.str,r=e.len;k(t,(function(t){var s=l.d(t.yDoc),d=t.yDoc.getText(S);switch(c){case x:d.insert(n,o);break;case y:d.delete(n,r);break;default:throw new Error("Unexpected type")}var u=l.c(t.yDoc,s);return Object(a.a)(Object(a.a)({},t),{},{updates:[].concat(Object(i.a)(t.updates),[{action:e,payload:u}])})}))}function A(e){var t=e.from,c=e.to,n=e.index;k(t,(function(e){if(e){var t=C[c],o=void 0===n?e.updates:[e.updates[n]];return o.forEach((function(e){l.b(t.yDoc,e.payload)})),Object(a.a)(Object(a.a)({},e),{},{updates:e.updates.filter((function(e){return!o.includes(e)}))})}}))}var _=o===u;return Object(p.jsxs)("div",{className:"App",children:[Object(p.jsx)(v,{scenarios:R,currentScenario:o,currentScenarioStepIndex:m,onScenarioChange:function(e){r(e),D(0),E([])},onNextStep:function(){D(m+1);var e=R[o],t=Object(d.a)(e[m],2),c=t[0],n=t[1];switch(c){case b:T();break;case f:F(n);break;case O:A(n);break;case h:U(n);break;default:throw new Error("Unexpected action: "+c)}},onRestartStep:function(){D(0),E([])},onOpenDoc:T}),Object(p.jsx)("div",{className:"docs-container",children:C.filter(Boolean).map((function(e){return Object(p.jsx)(I,{doc:e,docs:C,editable:_,onCloseDoc:U,onEditorChange:F,onSync:A},e.id)}))})]})}s.a.render(Object(p.jsx)(o.a.StrictMode,{children:Object(p.jsx)(U,{})}),document.getElementById("root"))}},[[50,1,2]]]);
//# sourceMappingURL=main.6a0b3cc3.chunk.js.map